import{S as Y,h as Z,s as $,Q as y,a6 as N,I as L,R as D,T as F,a7 as O,J as P,p as b,k as B,a2 as g,ae as ee,C as te,D as ae,U as h,a3 as oe,ar as H,E as se,K as M,ao as re,o as le,t as ie,ak as ne,H as de,ad as ce,L as I,u as ue,f as K,X as fe,aH as me,as as pe,af as _e}from"./vendor.3ae73048.js";import{T as z,R as be,S as ge,I as he,a as xe,F as ve,as as we,at as je,b as Ee,D as Te,E as ye,aJ as De}from"./Authenticated.43a5e742.js";import{aS as Fe,cK as W,e as ke}from"./index.146c2037.js";import{eQ as J,eR as Q,bD as Ve,a as Se,p as Re,s as Ie,eS as V,av as q,eT as Ae}from"./index.9987ff70.js";import"./types.8cb6216c.js";import{I as Ce}from"./Icon.61279884.js";import{D as Le}from"./DocumentDownload.7e4b12e9.js";import{t as Pe}from"./Spinner.012207c4.js";import"./router.1b465492.js";import"./auth.ae36c178.js";import"./helpers.7177ca38.js";import"./createNew.a4a688d1.js";import"./jobs.7ab064ef.js";import"./index.c4392b02.js";import"./jobs.d50d1674.js";import"./Logout.c3964a48.js";import"./index.11580965.js";import"./index.2e3bb17a.js";import"./ChevronUp.0ab7bee0.js";import"./Folder.9bc96b35.js";import"./LockClosed.9ead7228.js";import"./cleanupData.f259a128.js";import"./Exclamation.f44359c6.js";import"./TagCount.d4471cb8.js";import"./Tag.2b4e7c42.js";import"./Workflow.261abe6c.js";import"./Database.55c9be70.js";import"./Search.fa01495d.js";import"./LightningBolt.e8bda490.js";import"./SidebarLeftOpen.3b7701dd.js";const{window:Be}=me;function G(i,r,l){const d=i.slice();return d[18]=r[l],d}function X(i){let r,l=J[i[18]]+"",d,u,f;return{c(){r=y("option"),d=N(l),u=L(),this.h()},l(n){r=D(n,"OPTION",{});var m=F(r);d=O(m,l),u=P(m),m.forEach(b),this.h()},h(){r.__value=f=i[18],r.value=r.__value},m(n,m){B(n,r,m),g(r,d),g(r,u)},p(n,m){m&4&&l!==(l=J[n[18]]+"")&&ee(d,l),m&4&&f!==(f=n[18])&&(r.__value=f,r.value=r.__value)},d(n){n&&b(r)}}}function Ue(i){let r,l,d,u,f,n,m,w,_,a,j,x,k,S,R,A,v=i[2],c=[];for(let s=0;s<v.length;s+=1)c[s]=X(G(i,v,s));return a=new Ce({props:{src:Le}}),{c(){r=y("div"),l=y("div"),d=y("label"),u=N("Filter"),f=L(),n=y("select");for(let s=0;s<c.length;s+=1)c[s].c();m=L(),w=y("span"),_=y("button"),te(a.$$.fragment),j=L(),x=y("div"),k=y("div"),this.h()},l(s){r=D(s,"DIV",{class:!0});var p=F(r);l=D(p,"DIV",{class:!0});var e=F(l);d=D(e,"LABEL",{for:!0,class:!0});var t=F(d);u=O(t,"Filter"),t.forEach(b),f=P(e),n=D(e,"SELECT",{id:!0,class:!0});var o=F(n);for(let U=0;U<c.length;U+=1)c[U].l(o);o.forEach(b),e.forEach(b),m=P(p),w=D(p,"SPAN",{class:!0});var E=F(w);_=D(E,"BUTTON",{type:!0,class:!0});var T=F(_);ae(a.$$.fragment,T),T.forEach(b),E.forEach(b),p.forEach(b),j=P(s),x=D(s,"DIV",{class:!0});var C=F(x);k=D(C,"DIV",{id:!0}),F(k).forEach(b),C.forEach(b),this.h()},h(){h(d,"for","x-axis"),h(d,"class","inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm"),h(n,"id","x-axis"),h(n,"class","flex-1 block rounded-none rounded-r-md w-full pl-3 pr-10 py-1 text-sm leading-5 border-gray-300 focus:outline-none focus:shadow-outline-blue focus:border-blue-300"),i[0]===void 0&&oe(()=>i[7].call(n)),h(l,"class","flex rounded-md shadow-sm"),h(_,"type","button"),h(_,"class","inline-flex items-center px-1 py-1 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:text-gray-800 active:bg-gray-50 transition ease-in-out duration-150"),h(w,"class","inline-flex rounded-md shadow-sm"),h(r,"class","flex space-x-2 p-2 border-y border-gray-200"),h(k,"id","exposure-table"),h(x,"class","relative h-full overflow-y-auto")},m(s,p){B(s,r,p),g(r,l),g(l,d),g(d,u),g(l,f),g(l,n);for(let e=0;e<c.length;e+=1)c[e].m(n,null);H(n,i[0]),g(r,m),g(r,w),g(w,_),se(a,_,null),B(s,j,p),B(s,x,p),g(x,k),i[8](k),S=!0,R||(A=[M(Be,"keydown",i[3]),M(n,"change",i[7]),re(Pe.call(null,_,{content:"Download table CSV"})),M(_,"click",i[4])],R=!0)},p(s,[p]){if(p&4){v=s[2];let e;for(e=0;e<v.length;e+=1){const t=G(s,v,e);c[e]?c[e].p(t,p):(c[e]=X(t),c[e].c(),c[e].m(n,null))}for(;e<c.length;e+=1)c[e].d(1);c.length=v.length}p&5&&H(n,s[0])},i(s){S||(le(a.$$.fragment,s),S=!0)},o(s){ie(a.$$.fragment,s),S=!1},d(s){s&&b(r),ne(c,s),de(a),s&&b(j),s&&b(x),i[8](null),R=!1,ce(A)}}}function Me(i,r,l){let d,u,f,n,m,w;I(i,Q,e=>l(0,u=e)),I(i,Ve,e=>l(6,f=e)),I(i,Se,e=>l(10,n=e)),I(i,Re,e=>l(11,m=e)),I(i,Ie,e=>l(12,w=e));let _=!1,a,j;const x=e=>{var E;const t=a==null?void 0:a.getSelectedRows()[0],o=e==="next"?t==null?void 0:t.getNextRow():t==null?void 0:t.getPrevRow();if(t&&o){const T=(E=v(f,u).find(C=>C.uid===o.getData().uid))==null?void 0:E.uid;if(!T||!w)return;a==null||a.deselectRow(t),a==null||a.selectRow([o]),a.scrollToRow(T,"center",!1),q(T)}},k=e=>{switch(e.preventDefault(),e.key){case W.arrowDown:x("next");break;case W.arrowUp:x("prev");break}},S=()=>{!!a&&typeof(a==null?void 0:a.download)=="function"?a==null||a.download("csv",`${m}-${n}-${K(new Date,"P-HH_mm_ss")}.csv`):ke("Table download function does not exist: ",a)},R=(e,t,o)=>{var T;if(e.stopPropagation(),t.getField()!=="abs_file_path")return;const E=t.getData();o.element.parentElement.classList.add("cell-copied"),o.element.parentElement.setAttribute("data-text","Filename copied!"),De.writeText((T=E==null?void 0:E.abs_file_path)!=null?T:""),setTimeout(()=>{o.element.parentElement.classList.remove("cell-copied"),o.element.parentElement.removeAttribute("data-text")},1200)},A=e=>{var t;return typeof e=="number"&&e>0&&(t=`${(e/1e4).toFixed(3)}`)!=null?t:"-"},v=(e,t)=>e.filter(o=>t===V.all||t===V.inProgress&&(o==null?void 0:o.in_progress)===!0||t===V.processed&&(o==null?void 0:o.stage)==="ready"||t===V.failed&&(o==null?void 0:o.failed)===!0||t===V.accepted&&(o==null?void 0:o.threshold_reject)===!1&&(o==null?void 0:o.manual_reject)===!1||t===V.rejected&&((o==null?void 0:o.threshold_reject)===!0||(o==null?void 0:o.manual_reject)===!0)),c=()=>{!a||a.replaceData(v(f,u))};ue(()=>{z.registerModule([be,ge,he,xe,ve,we,je,Ee,Te,ye]),a=new z(j,{data:v(f,u),reactiveData:!0,movableColumns:!0,selectable:1,index:"uid",height:"100%",layout:"fitDataFill",columns:[{title:"ID",field:"uid",frozen:!0},{title:"Timestamp",field:"found_at",formatter:e=>{var t;return(t=K(e.getValue(),"P HH:mm:ss"))!=null?t:"-"},sorter:(e,t)=>e-t},{title:"Total Motion (pix)",field:"attributes.total_motion_dist",formatter:e=>{var t;return(t=e.getValue().toFixed(2))!=null?t:"-"}},{title:"Max In-frame Motion",field:"attributes.max_intra_frame_motion",formatter:e=>{var t;return(t=e.getValue().toFixed(3))!=null?t:"-"}},{title:"Defocus Avg. (\u03BCm)",field:"attributes.average_defocus",formatter:e=>A(e.getValue())},{title:"Defocus Range (A)",field:"attributes.defocus_range",formatter:e=>{var t;return(t=e.getValue().toFixed(0))!=null?t:"-"}},{title:"Astigmatism Angle (deg)",field:"attributes.astigmatism_angle",formatter:e=>{var t;return(t=e.getValue().toFixed(1))!=null?t:"-"}},{title:"Astigmatism",field:"attributes.astigmatism",formatter:e=>{var t;return(t=e.getValue().toFixed(2))!=null?t:"-"}},{title:"Phase Shift (deg)",field:"attributes.phase_shift",formatter:e=>{var t;return(t=e.getValue().toFixed(1))!=null?t:"-"}},{title:"CTF Fit (A)",field:"attributes.ctf_fit_to_A",formatter:e=>{var t;return(t=e.getValue().toFixed(3))!=null?t:"-"}},{title:"Relative Ice Thickness",field:"attributes.ice_thickness_rel",formatter:e=>{var t;return(t=e.getValue().toFixed(3))!=null?t:"-"}},{title:"Sample Tilt (deg)",field:"attributes.df_tilt_angle",formatter:e=>{var t;return(t=e.getValue().toFixed(1))!=null?t:"-"}},{title:"Total Manual Picks",field:"attributes.total_manual_picks",formatter:e=>{var t;return(t=e.getValue().toFixed(0))!=null?t:"-"}},{title:"Total Blob Picks",field:"attributes.total_blob_picks",formatter:e=>{var t;return(t=e.getValue().toFixed(0))!=null?t:"-"}},{title:"Median Blob Pick Score",field:"attributes.blob_pick_score_median",formatter:e=>{var t;return(t=e.getValue().toFixed(3))!=null?t:"-"}},{title:"Total Template Picks",field:"attributes.total_template_picks",formatter:e=>{var t;return(t=e.getValue().toFixed(0))!=null?t:"-"}},{title:"Median Template Pick Score",field:"attributes.template_pick_score_median",formatter:e=>{var t;return(t=e.getValue().toFixed(0))!=null?t:"-"}},{title:"Total Extracted Particles",field:"attributes.total_extracted_particles",formatter:e=>{var t;return(t=e.getValue().toFixed(0))!=null?t:"-"}},{title:"Total Extracted Particles (Manual)",field:"attributes.total_extracted_particles_manual",formatter:e=>{var t;return(t=e.getValue().toFixed(0))!=null?t:"-"}},{title:"Stage",field:"stage"},{title:"Threshold Reject",field:"threshold_reject"},{title:"Manual Reject",field:"manual_reject"},{title:"File Path",field:"abs_file_path",formatter:e=>(e.getElement().classList.add("hover:border","hover:border-blue-500"),e.getValue())}]}),a.on("tableBuilt",()=>{l(5,_=!0)}),a.on("rowClick",(e,t)=>q(t.getData().uid)),a.on("cellClick",(e,t)=>R(e,t,a)),Fe&&(window._table=a),Ae.set(a)}),fe(()=>{a==null||a.destroy(),window._table&&delete window._table});function s(){u=pe(this),Q.set(u),l(2,d)}function p(e){_e[e?"unshift":"push"](()=>{j=e,l(1,j)})}return i.$$.update=()=>{i.$$.dirty&97&&_&&Array.isArray(f)&&typeof u=="string"&&c()},l(2,d=Object.keys(V)),[u,j,d,k,S,_,f,s,p]}class bt extends Y{constructor(r){super();Z(this,r,Me,Ue,$,{})}}export{bt as default};
