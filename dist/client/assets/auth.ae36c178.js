var A=Object.defineProperty,f=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var p=(a,o,e)=>o in a?A(a,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[o]=e,y=(a,o)=>{for(var e in o||(o={}))E.call(o,e)&&p(a,e,o[e]);if(d)for(var e of d(o))T.call(o,e)&&p(a,e,o[e]);return a},k=(a,o)=>f(a,w(o));import{g as h}from"./vendor.3ae73048.js";import{l as i,v as _,p as r,o as $,s as l,n as s,r as v,t as b}from"./index.146c2037.js";const j=async(a,o)=>{if(i("login"),_(a,o)===!0)try{const{user:e,ddpToken:t,runningVersion:n,jobTypesAvailable:c,lanes:g,targets:u}=await r("/api/auth/login",{email:a,password:$(o)});l.set({user:e,ddpToken:t,runningVersion:(0,eval)(`(${n})`),jobTypesAvailable:(0,eval)(`(${c})`),lanes:(0,eval)(`(${g})`),targets:(0,eval)(`(${u})`),keycloakAuthEnabled:null}),s.reset(),v()}catch(e){e instanceof Error&&s.add({title:e.message,type:"danger",style:"minimal"})}else s.add({title:"Invalid email or password",type:"danger",style:"minimal"})},L=async()=>{i("logout");try{await r("/api/auth/logout"),l.set(k(y({},b),{keycloakAuthEnabled:h(l).keycloakAuthEnabled}))}catch(a){console.error("logout error",a)}},S=async(a=null,o=null,e=null)=>{i("keycloak login");try{if(a){const{user:t,ddpToken:n,runningVersion:c,jobTypesAvailable:g,lanes:u,targets:m}=await r("/api/auth/keycloak-login",{code:a,state:o});l.set({user:t,ddpToken:n,runningVersion:(0,eval)(`(${c})`),jobTypesAvailable:(0,eval)(`(${g})`),lanes:(0,eval)(`(${u})`),targets:(0,eval)(`(${m})`),keycloakAuthEnabled:!0}),s.reset(),v()}else{const n=await(await fetch(`/api/auth/keycloak-login?redirect_uri=${encodeURIComponent(e!=null?e:"")}`)).json();window.location.href=n.loginUrl}}catch(t){t instanceof Error&&s.add({title:t.message,type:"danger",style:"minimal"})}},V=async()=>{i("keycloak logout");try{await r("/api/auth/keycloak-logout"),l.set(k(y({},b),{keycloakAuthEnabled:h(l).keycloakAuthEnabled}))}catch(a){console.error("Keycloak logout error",a)}};var M=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",login:j,logout:L,keycloakLogin:S,keycloakLogout:V});export{M as a,V as b,L as c,S as k,j as l};
