import{S as te,h as se,s as re,Q as D,R as I,T as R,p as v,U as T,k as $,a2 as w,K as q,ac as A,aM as j,u as Ne,X as Se,aH as Le,w as Ce,af as je,C as oe,D as ae,E as ne,ao as ie,o as le,t as ce,H as ue,ad as ve,r as we,a6 as de,I as Q,a7 as fe,J as X,ae as Ve,a3 as Be,ar as xe,ak as He,f as Pe,as as Oe}from"./vendor.3ae73048.js";import{e as ee,f as ye,g as pe}from"./interactive.28807de7.js";import{T as Te,R as Ke,S as ze,I as Ge,a as Je,F as qe,as as Qe,at as Xe,b as Ye,D as We,E as Ze,aJ as $e}from"./Authenticated.43a5e742.js";import{aS as et,aG as tt,cK as Ee,e as st}from"./index.146c2037.js";import"./types.8cb6216c.js";import{I as De}from"./Icon.61279884.js";import{D as rt}from"./Download.0ce79951.js";import{t as me}from"./Spinner.012207c4.js";import{D as ot}from"./DocumentDownload.7e4b12e9.js";import{T as at}from"./Target.7baf7004.js";const{window:nt}=Le;function it(r){let e,t,a,o;return{c(){e=D("div"),t=D("div"),this.h()},l(d){e=I(d,"DIV",{class:!0});var n=R(e);t=I(n,"DIV",{id:!0}),R(t).forEach(v),n.forEach(v),this.h()},h(){T(t,"id","exposure-table"),T(e,"class","relative h-full min-h-[400px] overflow-y-auto")},m(d,n){$(d,e,n),w(e,t),r[14](t),a||(o=q(nt,"keyup",r[7]),a=!0)},p:A,i:A,o:A,d(d){d&&v(e),r[14](null),a=!1,o()}}}const be=(r,e,t=ye.num_particles)=>r.filter(a=>e===ee.all||e===ee.havePicks&&a[t]>0||e===ee.haveNoPicks&&a[t]<=0);function lt(r,e,t){let a,o=A,d=()=>(o(),o=j(b,s=>t(17,a=s)),b),n,c=A,f=()=>(c(),c=j(B,s=>t(18,n=s)),B),l,x=A,y=()=>(x(),x=j(_,s=>t(12,l=s)),_),E,M=A,h=()=>(M(),M=j(O,s=>t(13,E=s)),O),m,N=A,F=()=>(N(),N=j(g,s=>t(19,m=s)),g),k,S=A,H=()=>(S(),S=j(u,s=>t(20,k=s)),u);r.$$.on_destroy.push(()=>o()),r.$$.on_destroy.push(()=>c()),r.$$.on_destroy.push(()=>x()),r.$$.on_destroy.push(()=>M()),r.$$.on_destroy.push(()=>N()),r.$$.on_destroy.push(()=>S());let{micrographsList:g}=e;F();let{tableFilter:O}=e;h();let{tabulatorTable:V=Ce(null)}=e,{selectedMic:_}=e;y();let{fields:u}=e;H();let{overviewHoverUid:L}=e,{hoverAnchorNode:b}=e;d();let{hasThumbnails:B}=e;f();let{filterAttribute:C=ye.num_particles}=e,{setMicrograph:K}=e,G=!1,i,P;const J=s=>{var Z;const p=i==null?void 0:i.getSelectedRows()[0],U=s==="next"?p==null?void 0:p.getNextRow():p==null?void 0:p.getPrevRow();if(p&&U){const _e=(Z=be(m,E,C).find(ke=>ke.idx===U.getData().idx))==null?void 0:Z.uid;if(!_e)return;i==null||i.deselectRow(p),i==null||i.selectRow([U]),i.scrollToRow(l.idx,"center",!1),K(_e)}},Y=s=>{if(!(s.metaKey||s.ctrlKey||tt(s)))switch(s.preventDefault(),s.key){case Ee.arrowDown:J("next");break;case Ee.arrowUp:J("prev");break}},W=(s,p,U)=>{if(s.stopPropagation(),p.getField()!=="fname")return;const Z=p.getData();U.element.parentElement.classList.add("cell-copied"),U.element.parentElement.setAttribute("data-text","Filename copied!"),$e.writeText(Z.fname),setTimeout(()=>{U.element.parentElement.classList.remove("cell-copied"),U.element.parentElement.removeAttribute("data-text")},1200)},z=()=>!!i&&typeof(l==null?void 0:l.idx)=="number"&&(i==null?void 0:i.getRow(l.idx)),he=()=>{i.deselectRow(),i.selectRow([l.idx]),i.scrollToRow(l.idx,"center",!1)},ge=()=>{z()&&he()},Ue=()=>{z()&&!(i==null?void 0:i.getSelectedRows().some(s=>s.getIndex()===(l==null?void 0:l.idx)))&&he()},Me=()=>{!G||(i.replaceData(be(m,E,C)),ge())},Fe=()=>k.sort((s,p)=>s.name==="idx"?-1:p.name==="idx"?1:0).map(s=>s.name==="idx"?{title:s.short,field:s.name,frozen:!0}:s.name==="fname"?{title:s.short,field:s.name,formatter:p=>(p.getElement().classList.add("hover:border","hover:border-blue-500"),p.getValue())}:{title:s.short,field:s.name});Ne(()=>{const s=Fe();Te.registerModule([Ke,ze,Ge,Je,qe,Qe,Xe,Ye,We,Ze]),i=new Te(P,{data:be(m,E,C),columns:s,reactiveData:!0,movableColumns:!0,selectable:1,height:"100%",layout:"fitDataFill",index:"idx"}),i.on("tableBuilt",()=>{ge(),G=!0}),i.on("rowClick",(p,U)=>{(l==null?void 0:l.uid)!==U.getData().uid&&K(U.getData().uid)}),i.on("cellClick",(p,U)=>W(p,U,i)),n&&(i.on("rowMouseEnter",(p,U)=>{typeof U.getIndex()=="number"&&(a!==P&&b.set(P),L.set(U.getIndex()))}),i.on("rowMouseLeave",()=>{L.set(null)})),et&&(window._table=i),V.set(i)}),Se(()=>{i==null||i.destroy(),window._table&&delete window._table});function Ae(s){je[s?"unshift":"push"](()=>{P=s,t(6,P)})}return r.$$set=s=>{"micrographsList"in s&&F(t(0,g=s.micrographsList)),"tableFilter"in s&&h(t(1,O=s.tableFilter)),"tabulatorTable"in s&&t(8,V=s.tabulatorTable),"selectedMic"in s&&y(t(2,_=s.selectedMic)),"fields"in s&&H(t(3,u=s.fields)),"overviewHoverUid"in s&&t(9,L=s.overviewHoverUid),"hoverAnchorNode"in s&&d(t(4,b=s.hoverAnchorNode)),"hasThumbnails"in s&&f(t(5,B=s.hasThumbnails)),"filterAttribute"in s&&t(10,C=s.filterAttribute),"setMicrograph"in s&&t(11,K=s.setMicrograph)},r.$$.update=()=>{r.$$.dirty&8192&&Me(),r.$$.dirty&4096&&Ue()},[g,O,_,u,b,B,P,Y,V,L,C,K,l,E,Ae]}class Tt extends te{constructor(e){super();se(this,e,lt,it,re,{micrographsList:0,tableFilter:1,tabulatorTable:8,selectedMic:2,fields:3,overviewHoverUid:9,hoverAnchorNode:4,hasThumbnails:5,filterAttribute:10,setMicrograph:11})}}function ct(r){let e,t,a,o,d,n,c;return o=new De({props:{src:rt,modifier:"text-gray-500 hover:text-gray-600"}}),{c(){e=D("div"),t=D("span"),a=D("button"),oe(o.$$.fragment),this.h()},l(f){e=I(f,"DIV",{class:!0});var l=R(e);t=I(l,"SPAN",{class:!0});var x=R(t);a=I(x,"BUTTON",{class:!0});var y=R(a);ae(o.$$.fragment,y),y.forEach(v),x.forEach(v),l.forEach(v),this.h()},h(){T(a,"class","-ml-px relative inline-flex items-center px-1.5 py-1 rounded-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150 border-gray-300 bg-white text-gray-600 hover:text-gray-500 focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-100 active:text-gray-700"),T(t,"class","inline-flex shadow-sm rounded-md opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-opacity duration-100"),T(e,"class","absolute z-10 top-2 right-2 flex")},m(f,l){$(f,e,l),w(e,t),w(t,a),ne(o,a,null),d=!0,n||(c=[ie(me.call(null,a,{content:"Download micrograph image",placement:"bottom"})),q(a,"click",r[2])],n=!0)},p:A,i(f){d||(le(o.$$.fragment,f),d=!0)},o(f){ce(o.$$.fragment,f),d=!1},d(f){f&&v(e),ue(o),n=!1,ve(c)}}}function ut(r,e,t){let a,o=A,d=()=>(o(),o=j(x,h=>t(3,a=h)),x),n,c=A,f=()=>(c(),c=j(l,h=>t(4,n=h)),l);r.$$.on_destroy.push(()=>o()),r.$$.on_destroy.push(()=>c());let{currentImageUrl:l}=e;f();let{selectedMicUid:x}=e;d();const{projectUid:y,jobUid:E}=we("jobData"),M=()=>{const h=document.getElementById("exposure-canvas"),m=h.getContext("2d");if(typeof m=="undefined"||m===null||n===null)return;m.globalCompositeOperation="destination-over";const N=new Image;N.src=n,N.onload=()=>{m.drawImage(N,0,0);const F=document.createElement("a");F.download=`${y}-${E}-${a}.png`,F.href=h.toDataURL(),F.click()}};return r.$$set=h=>{"currentImageUrl"in h&&f(t(0,l=h.currentImageUrl)),"selectedMicUid"in h&&d(t(1,x=h.selectedMicUid))},[l,x,M]}class Et extends te{constructor(e){super();se(this,e,ut,ct,re,{currentImageUrl:0,selectedMicUid:1})}}function Ie(r,e,t){const a=r.slice();return a[12]=e[t],a}function Re(r){let e,t=pe[r[12]]+"",a,o,d;return{c(){e=D("option"),a=de(t),o=Q(),this.h()},l(n){e=I(n,"OPTION",{});var c=R(e);a=fe(c,t),o=X(c),c.forEach(v),this.h()},h(){e.__value=d=r[12],e.value=e.__value},m(n,c){$(n,e,c),w(e,a),w(e,o)},p(n,c){c&8&&t!==(t=pe[n[12]]+"")&&Ve(a,t),c&8&&d!==(d=n[12])&&(e.__value=d,e.value=e.__value)},d(n){n&&v(e)}}}function dt(r){let e,t,a,o,d,n,c,f,l,x,y,E,M,h,m,N,F,k,S,H,g,O;l=new at({});let V=r[3],_=[];for(let u=0;u<V.length;u+=1)_[u]=Re(Ie(r,V,u));return S=new De({props:{src:ot}}),{c(){e=D("div"),t=D("div"),a=D("span"),o=de("Micrographs"),d=Q(),n=D("div"),c=D("div"),f=D("button"),oe(l.$$.fragment),x=Q(),y=D("div"),E=D("label"),M=de("Filter"),h=Q(),m=D("select");for(let u=0;u<_.length;u+=1)_[u].c();N=Q(),F=D("span"),k=D("button"),oe(S.$$.fragment),this.h()},l(u){e=I(u,"DIV",{class:!0});var L=R(e);t=I(L,"DIV",{class:!0});var b=R(t);a=I(b,"SPAN",{class:!0});var B=R(a);o=fe(B,"Micrographs"),B.forEach(v),d=X(b),n=I(b,"DIV",{class:!0});var C=R(n);c=I(C,"DIV",{class:!0});var K=R(c);f=I(K,"BUTTON",{type:!0,class:!0});var G=R(f);ae(l.$$.fragment,G),G.forEach(v),K.forEach(v),x=X(C),y=I(C,"DIV",{class:!0});var i=R(y);E=I(i,"LABEL",{for:!0,class:!0});var P=R(E);M=fe(P,"Filter"),P.forEach(v),h=X(i),m=I(i,"SELECT",{id:!0,class:!0});var J=R(m);for(let z=0;z<_.length;z+=1)_[z].l(J);J.forEach(v),i.forEach(v),N=X(C),F=I(C,"SPAN",{class:!0});var Y=R(F);k=I(Y,"BUTTON",{type:!0,class:!0});var W=R(k);ae(S.$$.fragment,W),W.forEach(v),Y.forEach(v),C.forEach(v),b.forEach(v),L.forEach(v),this.h()},h(){T(a,"class","text-sm leading-4 font-medium text-gray-700"),T(f,"type","button"),T(f,"class","inline-flex items-center px-1 py-1 border border-gray-300 text-xs leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 active:text-gray-800 active:bg-gray-50 transition ease-in-out duration-150"),T(c,"class","flex mr-2 rounded-md shadow-sm"),T(E,"for","x-axis"),T(E,"class","inline-flex items-center px-2 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-xs"),T(m,"id","x-axis"),T(m,"class","flex-1 block rounded-none rounded-r-md w-full pl-3 pr-8 py-0.5 text-xs leading-5 border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),r[4]===void 0&&Be(()=>r[7].call(m)),T(y,"class","flex rounded-md shadow-sm"),T(k,"type","button"),T(k,"class","inline-flex items-center px-1 py-1 ml-2 border border-gray-300 text-xs leading-4 font-medium rounded-md shadow-sm text-gray-500 bg-white hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 active:text-gray-800 active:bg-gray-50 transition ease-in-out duration-150"),T(F,"class","inline-flex rounded-md"),T(n,"class","flex"),T(t,"class","flex items-center justify-between w-full px-2"),T(e,"class","w-full py-1.5 z-20 whitespace-nowrap bg-gray-100 border border-l-none border-gray-200")},m(u,L){$(u,e,L),w(e,t),w(t,a),w(a,o),w(t,d),w(t,n),w(n,c),w(c,f),ne(l,f,null),w(n,x),w(n,y),w(y,E),w(E,M),w(y,h),w(y,m);for(let b=0;b<_.length;b+=1)_[b].m(m,null);xe(m,r[4]),w(n,N),w(n,F),w(F,k),ne(S,k,null),H=!0,g||(O=[ie(me.call(null,f,{content:"Scroll to selected row"})),q(f,"click",r[5]),q(m,"change",r[7]),ie(me.call(null,k,{content:"Download table csv"})),q(k,"click",r[6])],g=!0)},p(u,[L]){if(L&8){V=u[3];let b;for(b=0;b<V.length;b+=1){const B=Ie(u,V,b);_[b]?_[b].p(B,L):(_[b]=Re(B),_[b].c(),_[b].m(m,null))}for(;b<_.length;b+=1)_[b].d(1);_.length=V.length}L&24&&xe(m,u[4])},i(u){H||(le(l.$$.fragment,u),le(S.$$.fragment,u),H=!0)},o(u){ce(l.$$.fragment,u),ce(S.$$.fragment,u),H=!1},d(u){u&&v(e),ue(l),He(_,u),ue(S),g=!1,ve(O)}}}function ft(r,e,t){let a,o,d=A,n=()=>(d(),d=j(h,g=>t(8,o=g)),h),c,f=A,l=()=>(f(),f=j(m,g=>t(9,c=g)),m),x,y=A,E=()=>(y(),y=j(M,g=>t(4,x=g)),M);r.$$.on_destroy.push(()=>d()),r.$$.on_destroy.push(()=>f()),r.$$.on_destroy.push(()=>y());let{tableFilter:M}=e;E();let{tabulatorTable:h}=e;n();let{selectedMic:m}=e;l();const{projectUid:N,jobUid:F}=we("jobData"),k=()=>{!!o&&typeof(c==null?void 0:c.idx)=="number"&&(o==null?void 0:o.getRow(c.idx))&&(o==null||o.scrollToRow(c.idx,"center",!1))},S=()=>{!!o&&typeof(o==null?void 0:o.download)=="function"?o==null||o.download("csv",`${N}-${F}-${Pe(new Date,"P-HH_mm_ss")}.csv`):st("Table download function does not exist: ",o)};function H(){x=Oe(this),M.set(x),t(3,a)}return r.$$set=g=>{"tableFilter"in g&&E(t(0,M=g.tableFilter)),"tabulatorTable"in g&&n(t(1,h=g.tabulatorTable)),"selectedMic"in g&&l(t(2,m=g.selectedMic))},t(3,a=Object.keys(ee)),[M,h,m,a,x,k,S,H]}class Dt extends te{constructor(e){super();se(this,e,ft,dt,re,{tableFilter:0,tabulatorTable:1,selectedMic:2})}}export{Et as D,Dt as M,Tt as a,be as g};
