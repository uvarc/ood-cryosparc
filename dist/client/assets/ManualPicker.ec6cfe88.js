var At=Object.defineProperty,Rt=Object.defineProperties;var Nt=Object.getOwnPropertyDescriptors;var kt=Object.getOwnPropertySymbols;var Lt=Object.prototype.hasOwnProperty,Wt=Object.prototype.propertyIsEnumerable;var It=(e,t,s)=>t in e?At(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ht=(e,t)=>{for(var s in t||(t={}))Lt.call(t,s)&&It(e,s,t[s]);if(kt)for(var s of kt(t))Wt.call(t,s)&&It(e,s,t[s]);return e},bt=(e,t)=>Rt(e,Nt(t));import{w as xe,aT as Bt,e as de,g as _,S as rt,h as nt,s as ot,af as ct,at as vt,Q as A,a6 as Te,I as F,C as X,R,T as B,a7 as Se,p as $,J as Y,D as K,U as y,k as Ve,a2 as d,E as q,K as je,au as _t,o as O,t as H,H as G,ad as Ct,aM as ue,ac as oe,P as dt,ap as wt,r as yt,L as Ke,l as Pt,m as $t,ao as at,q as Vt,u as Mt,an as Et,X as Ot,ae as it,ay as Ht}from"./vendor.3ae73048.js";import{cM as Ft,w as fe,cL as me,u as Ze,be as Yt,e as Xt,z as Kt,a as Dt,bb as lt,ba as _e,cN as qt,aB as Je,aF as Gt}from"./index.146c2037.js";import{m as Zt,r as Jt}from"./Logout.c3964a48.js";import{l as Tt}from"./lodash.7e9ccf5d.js";import{c as ge,M as St,B as Qt,d as es,e as xt}from"./interactive.28807de7.js";import{g as ts,M as ss,a as rs,D as ns}from"./MicrographsTableHeader.ec2a5b28.js";import"./types.8cb6216c.js";import{t as ut,S as os}from"./Spinner.012207c4.js";import{I as as}from"./InteractiveErrorNotice.aa122c8a.js";import{S as is,O as ls,E as us}from"./OverviewHoverExposure.d1e49005.js";import{I as Oe}from"./Icon.61279884.js";import{D as cs}from"./DotsVertical.9505a1c9.js";import{P as ds}from"./Popover.0a97ebac.js";import{P as fs,B as ms,S as gs,C as jt,U as ps,E as hs,L as bs}from"./ExposureViewer.31cd6713.js";import{n as vs,w as _s}from"./wNumb.f094d5b4.js";import{T as ws}from"./index.11580965.js";import{Z as ys,M as xs,H as ks}from"./Move.f1d750f0.js";import{C as Is,a as Cs}from"./CursorPlus.a3135a9d.js";import{R as Ps}from"./Ruler.d04aefd7.js";import{C as $s}from"./Cube.8308121f.js";import{C as Ms}from"./CursorClick.5587dbc0.js";import{M as Es}from"./MinusCircle.54d00c03.js";import{S as Ds,a as Ts}from"./ShieldCheck.8626649a.js";import"./helpers.7177ca38.js";import"./router.1b465492.js";import"./Authenticated.43a5e742.js";import"./auth.ae36c178.js";import"./createNew.a4a688d1.js";import"./jobs.7ab064ef.js";import"./index.c4392b02.js";import"./jobs.d50d1674.js";import"./index.9987ff70.js";import"./cleanupData.f259a128.js";import"./Exclamation.f44359c6.js";import"./TagCount.d4471cb8.js";import"./ChevronUp.0ab7bee0.js";import"./Tag.2b4e7c42.js";import"./Workflow.261abe6c.js";import"./Database.55c9be70.js";import"./Search.fa01495d.js";import"./LightningBolt.e8bda490.js";import"./SidebarLeftOpen.3b7701dd.js";import"./Download.0ce79951.js";import"./DocumentDownload.7e4b12e9.js";import"./Target.7baf7004.js";import"./index.2e3bb17a.js";import"./plotly.2255cf4f.js";import"./SwitchHorizontal.0e438e3b.js";import"./Toggle.70c4dc3f.js";import"./QuestionMarkCircle.1d0a7a5c.js";import"./DownloadImage.d10f042a.js";import"./ArrowsExpand.dfc75310.js";import"./Folder.9bc96b35.js";import"./LockClosed.9ead7228.js";const Ss=(e,t,s,r)=>{const o=xe(Ft?"localhost":e),a=xe(t),l=xe(s),w=xe(r),f=Bt(`${s}_${r}`),b=xe([]),h=xe(),p=xe(!1),m=xe(!1),g=xe(!1),k=de([m,g],([i,u])=>i&&u),I=fe(me(ge.lowpassFilter,_(f)),5),N=fe(me(ge.contrastMin,_(f)),null),j=fe(me(ge.contrastMax,_(f)),null),L=fe(me(ge.baseContrastMin,_(f)),null),M=fe(me(ge.baseContrastMax,_(f)),null),C=fe(me(ge.enableIntensity,_(f)),!1),P=fe(me(ge.showPicks,_(f)),!0),z=fe(me(ge.showBox,_(f)),!0),D=xe(null),E=de(D,i=>{var u;return(u=i==null?void 0:i.fields)!=null?u:[]}),ee=de(D,i=>{var u;return(u=i==null?void 0:i.height_pix)!=null?u:null}),ie=de(D,i=>{var u;return(u=i==null?void 0:i.width_pix)!=null?u:null}),re=de(D,i=>{var u;return(u=i==null?void 0:i.thumb_height_pix)!=null?u:null}),x=de(D,i=>{var u;return(u=i==null?void 0:i.thumb_width_pix)!=null?u:null}),T=de(D,i=>{var u;return(u=i==null?void 0:i.psize_A)!=null?u:null}),v=de(D,i=>{var u;return(u=i==null?void 0:i.num_mics_total)!=null?u:null}),S=de(D,i=>{var u;return(u=i==null?void 0:i.num_particles_initial)!=null?u:null}),c=de(D,i=>{var u;return(u=i==null?void 0:i.has_preview_thumbnails)!=null?u:null}),W=de(D,i=>{var u;return(u=i==null?void 0:i.has_denoised_mics)!=null?u:null}),Z=xe(!1),J=de(D,i=>(i==null?void 0:i.output_locations_only)===!0),le=xe([]),ze=de(le,i=>i.reduce((u,n)=>n.num_particles>0?++u:u,0)),be=de(le,i=>i.reduce((u,n)=>n.num_particles<=0?++u:u,0)),ke=de(le,i=>i.reduce((u,n)=>u+n.num_particles,0)),ne=fe(me(ge.selectedMicUid,_(f)),null),Le=de([le,ne],([i,u])=>i==null?void 0:i.find(n=>(n==null?void 0:n.uid)===u)),ce=xe(null),Ee=de([ce,le],([i,u])=>{var n,U;return(U=(n=u.find(V=>V.idx===i))==null?void 0:n.uid)!=null?U:null}),He=de([ce,le],([i,u])=>{var n;return(n=u.find(U=>U.idx===i))!=null?n:null}),Ie=xe([]),Ce=xe(null),Ue=fe(me(ge.boxsize,_(f)),360),we=fe(me(ge.particleDiameter,_(f)),135),Ae=fe(me(ge.picksColor,_(f)),"#00ff00"),We=fe(me(ge.boxColor,_(f)),"#8712B3"),pe=fe(me(ge.showScale,_(f)),!0),Q=fe(me(ge.plotAxisX,_(f)),St.idx),se=fe(me(ge.plotAxisY,_(f)),St.df_avg),Pe=fe(me(ge.chartType,_(f)),Qt.scatter),Re=fe(me(ge.nbinsx,_(f)),20),$e=de(E,i=>i==null?void 0:i.filter(u=>es.includes(u==null?void 0:u.name))),ye=xe(null),De=fe(me(ge.tableFilter,_(f)),xt.all),he=(i,u)=>{b.update(n=>[...n,u]),console.error(`${i} error: `,u)},te=async i=>{try{if(i){const u=await Ze.interactive.call(_(o),_(a),"enable_denoise_preview",{});(u==null?void 0:u.success)&&Z.set(!0)}else{const u=await Ze.interactive.call(_(o),_(a),"disable_denoise_preview",{});(u==null?void 0:u.success)&&Z.set(!1)}_(ne)&&Qe(_(ne))}catch{he("toggleUseDenoised",`Could not ${i?"enable":"disable"} denoised preview.`)}},Ne=i=>`/api/actions/interactive/exposure-thumbnail?${`host=${_(o)}&port=${_(a)}&mic_uid=${i}&zoom_level=${_(Yt)}`}`,Be=i=>{const u=_(ye),n=_(De),U=_(Le);if(!u)return Dt("Table does not exist");if(typeof(U==null?void 0:U.idx)!="number")return Dt("Selected micrograph index is not a number");const V=u.getRow(U.idx),ae=()=>{const Me=U.idx!==u.getRows().length+1;if(!u.getRow(Me?U.idx-1:U.idx+1))return u.replaceData(ts(_(le),_(De)));u.addData([U],!Me,Me?U.idx-1:U.idx+1)};n===xt.havePicks&&(V&&!i?u.deleteRow(U.idx):!V&&i&&ae()),n===xt.haveNoPicks&&(V&&i?u.deleteRow(U.idx):!V&&!i&&ae()),V&&(u==null||u.updateData([{idx:U==null?void 0:U.idx,num_particles:i}]))},ve=async(i,u)=>{try{await Ze.interactive.call(_(o),_(a),"add_pick",{mic_uid:_(ne),x_frac:i,y_frac:u}),qe()}catch{he("addPick",`Could not add pick for micrograph ${_(ne)} at x: ${i} y: ${u}.`)}},Ge=async(i,u,n)=>{try{await Ze.interactive.call(_(o),_(a),"remove_pick",{mic_uid:_(ne),x_frac:i,y_frac:u,dist_frac:n}),qe()}catch{he("removePick",`Could not remove pick for micrograph: ${_(ne)} at x: ${i} y: ${u}.`)}},Fe=async()=>{await Ze.interactive.call(_(o),_(a),"begin_extract",{box_size_pix:_(Ue)})},Ye=async()=>{var i,u,n;m.set(!0);try{const U=[];let V=null,ae=null;_(C)&&(V=_(N),ae=_(j));const Me=Ze.interactive.call(_(o),_(a),"get_micrograph_data",{mic_uid:_(ne),lp_filter_A:_(I),vmin:V,vmax:ae},!0,{signal:(i=_(h))==null?void 0:i.signal});if(U.push(Me),!_(C)){const tt=Ze.interactive.call(_(o),_(a),"get_intensity",{},!1,{signal:(u=_(h))==null?void 0:u.signal});U.push(tt)}_(Ce)&&URL.revokeObjectURL((n=_(Ce))!=null?n:"");const[Xe,et]=await Promise.all(U);if(!Xe)return;if(Xe){const tt=URL.createObjectURL(new Blob([Xe],{type:"image/png"}));Ce.set(tt)}et&&(L.set(et.intensity_min),M.set(et.intensity_max)),m.set(!1)}catch{he("getImage",`Could not get image for micrograph: ${_(ne)}.`),m.set(!1)}},st=Tt.exports.throttle(async()=>await Ye(),800),qe=async()=>{var i;try{g.set(!0);const u=await Ze.interactive.call(_(o),_(a),"get_picks",{mic_uid:_(ne)},!1,{signal:(i=_(h))==null?void 0:i.signal});if(!u)return;le.update(n=>n.map(U=>U.uid===_(ne)?bt(ht({},U),{num_particles:u.length}):U)),Be(u.length),Ie.set(u),g.set(!1)}catch{he("getPicks",`Could not get particle picks for micrograph: ${_(ne)}.`),g.set(!1)}},ft=Tt.exports.throttle(async()=>await qe(),800),Qe=i=>{var u;try{m.set(!0),g.set(!0),ne.set(i),(u=_(h))==null||u.abort(),h.set(new AbortController),st(),ft()}catch(n){Xt("setMicrograph error: ",n),m.set(!1),g.set(!1)}};return{host:o,port:a,interactiveError:b,loadingList:p,loadingImage:m,loadingPicks:g,loadingDisplay:k,lowPassFilter:I,contrastIntensityMin:N,contrastIntensityMax:j,baseContrastIntensityMin:L,baseContrastIntensityMax:M,enableIntensity:C,showPicks:P,showBox:z,interactiveInfo:D,fields:E,micrographsList:le,totalWithPicks:ze,totalWithoutPicks:be,allPicksCount:ke,selectedMicUid:ne,selectedMic:Le,currentPicks:Ie,currentImageUrl:Ce,boxsizeRawPix:Ue,particleDiameter:we,micWidth:ie,micHeight:ee,thumbHeight:re,thumbWidth:x,pSize:T,numMicsTotal:v,numParticlesInitial:S,hasThumbnails:c,hasDenoisedMics:W,useDenoised:Z,outputLocationsOnly:J,picksColor:Ae,boxColor:We,showScale:pe,tableFilter:De,overviewHoverUid:ce,overviewHoverUidFromIdx:Ee,plotAxisX:Q,plotAxisY:se,chartType:Pe,nbinsx:Re,hoverAttributes:$e,overviewHoverData:He,tabulatorTable:ye,getImage:Ye,getPicks:qe,addPick:ve,removePick:Ge,startExtraction:Fe,toggleUseDenoised:te,setMicrograph:Qe,getInteractiveInfo:async()=>{try{const i=await Ze.interactive.call(_(o),_(a),"get_interactive_info",{});(i==null?void 0:i.use_denoised)&&Z.set(i.use_denoised),D.set(i)}catch{he("getInteractiveInfo","Could not get interactive information to setup job.")}},getList:async()=>{var i,u;try{p.set(!0);const n=await Kt(`/api/actions/interactive/exposures?projectUid=${_(l)}&jobUid=${_(w)}`);if(n.data.length>0){const V=_(ne)===null?(u=(i=n.data)==null?void 0:i[0])==null?void 0:u.uid:_(ne);Qe(V)}const U=n.data.map(V=>{var ae,Me;return bt(ht({},V),{fname:(Me=(ae=V==null?void 0:V.fname)==null?void 0:ae.split("/"))==null?void 0:Me.slice(-1)[0],df_avg:parseFloat(V==null?void 0:V.df_avg).toFixed(0),ctf_fit_to_A:parseFloat(V==null?void 0:V.ctf_fit_to_A).toFixed(2)})});le.set(U),p.set(!1)}catch{he("getList",`Could get micrographs list for job ${_(l)} ${_(w)}.`),p.set(!1)}},getThumbnailUrl:Ne}};function js(e){let t,s,r,o,a,l,w,f,b,h,p,m,g,k,I,N,j;function L(C){e[16](C)}let M={};return e[7]!==void 0&&(M.value=e[7]),l=new ws({props:M}),ct.push(()=>vt(l,"value",L)),l.$on("click",e[17]),{c(){t=A("div"),s=A("div"),r=Te("Contrast Intensity Override"),o=F(),a=A("div"),X(l.$$.fragment),f=F(),b=A("input"),h=F(),p=A("div"),m=A("div"),g=F(),k=A("input"),this.h()},l(C){t=R(C,"DIV",{class:!0});var P=B(t);s=R(P,"DIV",{class:!0});var z=B(s);r=Se(z,"Contrast Intensity Override"),z.forEach($),o=Y(P),a=R(P,"DIV",{class:!0});var D=B(a);K(l.$$.fragment,D),D.forEach($),f=Y(P),b=R(P,"INPUT",{class:!0,type:!0}),h=Y(P),p=R(P,"DIV",{class:!0});var E=B(p);m=R(E,"DIV",{class:!0}),B(m).forEach($),E.forEach($),g=Y(P),k=R(P,"INPUT",{class:!0,type:!0}),P.forEach($),this.h()},h(){y(s,"class","relative inline-flex items-center px-2.5 py-1.5 rounded-l border text-xs whitespace-nowrap leading-4 font-medium text-gray-700 transition ease-in-out duration-150 border-gray-300 bg-white select-none"),y(a,"class","-ml-px relative inline-flex items-center px-2 border text-xs leading-4 font-medium transition ease-in-out duration-150 border-gray-300 bg-white text-gray-700"),y(b,"class","-ml-px relative block w-20 px-2.5 py-1.5 rounded-none bg-white text-xs leading-4 font-medium border border-gray-300 text-gray-700 hover:text-gray-600 focus:z-10 transition ease-in-out duration-150"),y(b,"type","number"),b.value=e[9],y(m,"class","horizontal-slider svelte-148dnij"),y(p,"class","-ml-px relative inline-flex items-center px-2.5 py-1.5 rounded-none border text-xs leading-4 font-medium transition ease-in-out duration-150 border-gray-300 bg-white text-gray-700"),y(k,"class","-ml-px relative block w-20 px-2.5 py-1.5 rounded-l-none rounded-r bg-white text-xs leading-4 font-medium border border-gray-300 text-gray-700 hover:text-gray-600 focus:z-10 transition ease-in-out duration-150 "),y(k,"type","number"),k.value=e[8],y(t,"class","flex shadow-sm rounded-md")},m(C,P){Ve(C,t,P),d(t,s),d(s,r),d(t,o),d(t,a),q(l,a,null),d(t,f),d(t,b),d(t,h),d(t,p),d(p,m),e[18](m),d(t,g),d(t,k),I=!0,N||(j=[je(b,"change",e[10]),je(b,"blur",e[12]),je(b,"keydown",e[12]),je(k,"change",e[11]),je(k,"blur",e[13]),je(k,"keydown",e[13])],N=!0)},p(C,[P]){const z={};!w&&P&128&&(w=!0,z.value=C[7],_t(()=>w=!1)),l.$set(z),(!I||P&512&&b.value!==C[9])&&(b.value=C[9]),(!I||P&256&&k.value!==C[8])&&(k.value=C[8])},i(C){I||(O(l.$$.fragment,C),I=!0)},o(C){H(l.$$.fragment,C),I=!1},d(C){C&&$(t),G(l),e[18](null),N=!1,Ct(j)}}}function zs(e,t,s){let r,o=oe,a=()=>(o(),o=ue(L,c=>s(7,r=c)),L),l,w=oe,f=()=>(w(),w=ue(C,c=>s(8,l=c)),C),b,h=oe,p=()=>(h(),h=ue(M,c=>s(9,b=c)),M),m,g=oe,k=()=>(g(),g=ue(z,c=>s(14,m=c)),z),I,N=oe,j=()=>(N(),N=ue(P,c=>s(15,I=c)),P);e.$$.on_destroy.push(()=>o()),e.$$.on_destroy.push(()=>w()),e.$$.on_destroy.push(()=>h()),e.$$.on_destroy.push(()=>g()),e.$$.on_destroy.push(()=>N());let{enableIntensity:L}=t;a();let{contrastIntensityMin:M}=t;p();let{contrastIntensityMax:C}=t;f();let{baseContrastIntensityMin:P}=t;j();let{baseContrastIntensityMax:z}=t;k();let{getImage:D}=t,E;const ee=c=>{var W;c.target.value.length>0&&((W=E==null?void 0:E.noUiSlider)==null||W.set([parseInt(c.target.value),l!=null?l:1]))},ie=c=>{var W;c.target.value.length>0&&((W=E==null?void 0:E.noUiSlider)==null||W.set([b!=null?b:-1,parseInt(c.target.value)]))},re=c=>{(c.keyCode===13||c.type==="blur")&&(dt(M,b=parseInt(c.target.value),b),r&&D())},x=c=>{(c.keyCode===13||c.type==="blur")&&(dt(C,l=parseInt(c.target.value),l),r&&D())};function T(c){r=c,L.set(r)}const v=()=>D();function S(c){ct[c?"unshift":"push"](()=>{E=c,s(6,E)})}return e.$$set=c=>{"enableIntensity"in c&&a(s(0,L=c.enableIntensity)),"contrastIntensityMin"in c&&p(s(1,M=c.contrastIntensityMin)),"contrastIntensityMax"in c&&f(s(2,C=c.contrastIntensityMax)),"baseContrastIntensityMin"in c&&j(s(3,P=c.baseContrastIntensityMin)),"baseContrastIntensityMax"in c&&k(s(4,z=c.baseContrastIntensityMax)),"getImage"in c&&s(5,D=c.getImage)},e.$$.update=()=>{var c,W;e.$$.dirty&50144&&E&&!(E==null?void 0:E.noUiSlider)&&I!==null&&m!==null&&(vs.create(E,{start:[b!=null?b:I,l!=null?l:m],range:{min:I,max:m},behaviour:"drag",tooltips:!0,connect:!0,format:_s({decimals:0})}),(c=E==null?void 0:E.noUiSlider)==null||c.on("update",(Z,J)=>{J===0?dt(M,b=parseInt(Z[J]),b):dt(C,l=parseInt(Z[J]),l)}),(W=E==null?void 0:E.noUiSlider)==null||W.on("change",()=>{r&&D()}))},[L,M,C,P,z,D,E,r,l,b,ee,ie,re,x,m,I,T,v,S]}class Us extends rt{constructor(t){super();nt(this,t,zs,js,ot,{enableIntensity:0,contrastIntensityMin:1,contrastIntensityMax:2,baseContrastIntensityMin:3,baseContrastIntensityMax:4,getImage:5})}}function zt(e){let t,s;return t=new ps({props:{useDenoised:e[11],toggleUseDenoised:e[12]}}),{c(){X(t.$$.fragment)},l(r){K(t.$$.fragment,r)},m(r,o){q(t,r,o),s=!0},p:oe,i(r){s||(O(t.$$.fragment,r),s=!0)},o(r){H(t.$$.fragment,r),s=!1},d(r){G(t,r)}}}function As(e){let t,s,r,o,a,l,w,f,b,h,p,m;r=new Us({props:{enableIntensity:e[13],contrastIntensityMin:e[14],contrastIntensityMax:e[15],baseContrastIntensityMin:e[16],baseContrastIntensityMax:e[17],getImage:e[18]}});let g=e[1]&&zt(e);return w=new gs({props:{showScale:e[9]}}),b=new jt({props:{title:"Picks Colour",selectedColour:e[2]}}),p=new jt({props:{title:"Box Colour",selectedColour:e[3]}}),{c(){t=A("div"),s=A("div"),X(r.$$.fragment),o=F(),a=A("div"),g&&g.c(),l=F(),X(w.$$.fragment),f=F(),X(b.$$.fragment),h=F(),X(p.$$.fragment),this.h()},l(k){t=R(k,"DIV",{class:!0});var I=B(t);s=R(I,"DIV",{class:!0});var N=B(s);K(r.$$.fragment,N),o=Y(N),a=R(N,"DIV",{class:!0});var j=B(a);g&&g.l(j),l=Y(j),K(w.$$.fragment,j),f=Y(j),K(b.$$.fragment,j),h=Y(j),K(p.$$.fragment,j),j.forEach($),N.forEach($),I.forEach($),this.h()},h(){y(a,"class","flex w-full space-x-1"),y(s,"class","flex flex-col items-start space-y-1"),y(t,"class","p-1 bg-gray-100 border border-gray-300 rounded-md shadow-lg text-sm")},m(k,I){Ve(k,t,I),d(t,s),q(r,s,null),d(s,o),d(s,a),g&&g.m(a,null),d(a,l),q(w,a,null),d(a,f),q(b,a,null),d(a,h),q(p,a,null),m=!0},p(k,I){k[1]?g?(g.p(k,I),I&2&&O(g,1)):(g=zt(k),g.c(),O(g,1),g.m(a,l)):g&&(Pt(),H(g,1,1,()=>{g=null}),$t())},i(k){m||(O(r.$$.fragment,k),O(g),O(w.$$.fragment,k),O(b.$$.fragment,k),O(p.$$.fragment,k),m=!0)},o(k){H(r.$$.fragment,k),H(g),H(w.$$.fragment,k),H(b.$$.fragment,k),H(p.$$.fragment,k),m=!1},d(k){k&&$(t),G(r),g&&g.d(),G(w),G(b),G(p)}}}function Rs(e){let t,s,r,o,a,l,w,f,b,h,p,m,g,k,I,N;o=new fs({props:{particleDiameter:e[5],showPicks:e[7],pSize:e[6],infoTooltop:!0}}),l=new ms({props:{boxsizeRawPix:e[4],showBox:e[8],pSize:e[6]}}),h=new Oe({props:{src:cs,size:4}});function j(M){e[19](M)}let L={modifier:"rounded-md",$$slots:{default:[As]},$$scope:{ctx:e}};return e[0]!==void 0&&(L.toggle=e[0]),m=new ds({props:L}),ct.push(()=>vt(m,"toggle",j)),{c(){t=A("div"),s=A("div"),r=A("div"),X(o.$$.fragment),a=F(),X(l.$$.fragment),w=F(),f=A("div"),b=A("button"),X(h.$$.fragment),p=F(),X(m.$$.fragment),this.h()},l(M){t=R(M,"DIV",{class:!0});var C=B(t);s=R(C,"DIV",{class:!0});var P=B(s);r=R(P,"DIV",{class:!0});var z=B(r);K(o.$$.fragment,z),a=Y(z),K(l.$$.fragment,z),z.forEach($),w=Y(P),f=R(P,"DIV",{class:!0});var D=B(f);b=R(D,"BUTTON",{class:!0});var E=B(b);K(h.$$.fragment,E),E.forEach($),p=Y(D),K(m.$$.fragment,D),D.forEach($),P.forEach($),C.forEach($),this.h()},h(){y(r,"class","flex flex-col"),y(b,"class","p-1.5 m-0 rounded border border-gray-300 bg-white text-xs leading-4"),y(f,"class","flex items-start h-full"),y(s,"class","scroll-wrapper flex justify-between flex-wrap gap-x-2 gap-y-1 w-full px-2 py-1.5 overflow-x-auto svelte-197zwar"),y(t,"class","relative w-full flex items-start justify-between whitespace-nowrap border-b border-gray-200 bg-gray-100")},m(M,C){Ve(M,t,C),d(t,s),d(s,r),q(o,r,null),d(r,a),q(l,r,null),d(s,w),d(s,f),d(f,b),q(h,b,null),d(f,p),q(m,f,null),k=!0,I||(N=je(b,"click",function(){wt(e[0])&&e[0].apply(this,arguments)}),I=!0)},p(M,[C]){e=M;const P={};C&1048578&&(P.$$scope={dirty:C,ctx:e}),!g&&C&1&&(g=!0,P.toggle=e[0],_t(()=>g=!1)),m.$set(P)},i(M){k||(O(o.$$.fragment,M),O(l.$$.fragment,M),O(h.$$.fragment,M),O(m.$$.fragment,M),k=!0)},o(M){H(o.$$.fragment,M),H(l.$$.fragment,M),H(h.$$.fragment,M),H(m.$$.fragment,M),k=!1},d(M){M&&$(t),G(o),G(l),G(h),G(m),I=!1,N()}}}function Ns(e,t,s){let r;const{picksColor:o,boxColor:a,boxsizeRawPix:l,particleDiameter:w,pSize:f,showPicks:b,showBox:h,showScale:p,hasDenoisedMics:m,useDenoised:g,toggleUseDenoised:k,enableIntensity:I,contrastIntensityMin:N,contrastIntensityMax:j,baseContrastIntensityMin:L,baseContrastIntensityMax:M,getImage:C}=yt("manualPickerData");Ke(e,m,D=>s(1,r=D));let P;function z(D){P=D,s(0,P)}return[P,r,o,a,l,w,f,b,h,p,m,g,k,I,N,j,L,M,C,z]}class Ls extends rt{constructor(t){super();nt(this,t,Ns,Rs,ot,{})}}function Ws(e){let t,s,r,o,a,l,w,f,b,h,p,m,g,k,I,N,j,L,M,C,P,z,D,E,ee,ie,re,x,T;return o=new Oe({props:{src:ys}}),f=new Oe({props:{src:xs}}),g=new Oe({props:{src:ks}}),j=new Oe({props:{src:Ps}}),P=new Oe({props:{src:Is}}),ee=new Oe({props:{src:Cs}}),{c(){t=A("div"),s=A("span"),r=A("button"),X(o.$$.fragment),l=F(),w=A("button"),X(f.$$.fragment),h=F(),p=A("span"),m=A("button"),X(g.$$.fragment),I=F(),N=A("button"),X(j.$$.fragment),M=F(),C=A("button"),X(P.$$.fragment),D=F(),E=A("button"),X(ee.$$.fragment),this.h()},l(v){t=R(v,"DIV",{class:!0});var S=B(t);s=R(S,"SPAN",{class:!0});var c=B(s);r=R(c,"BUTTON",{type:!0,class:!0});var W=B(r);K(o.$$.fragment,W),W.forEach($),l=Y(c),w=R(c,"BUTTON",{type:!0,class:!0});var Z=B(w);K(f.$$.fragment,Z),Z.forEach($),c.forEach($),h=Y(S),p=R(S,"SPAN",{class:!0});var J=B(p);m=R(J,"BUTTON",{type:!0,class:!0});var le=B(m);K(g.$$.fragment,le),le.forEach($),I=Y(J),N=R(J,"BUTTON",{type:!0,class:!0});var ze=B(N);K(j.$$.fragment,ze),ze.forEach($),M=Y(J),C=R(J,"BUTTON",{type:!0,class:!0});var be=B(C);K(P.$$.fragment,be),be.forEach($),D=Y(J),E=R(J,"BUTTON",{type:!0,class:!0});var ke=B(E);K(ee.$$.fragment,ke),ke.forEach($),J.forEach($),S.forEach($),this.h()},h(){y(r,"type","button"),y(r,"class",a=""+((e[0]===lt.zoom?e[2].active:e[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-l-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")),y(w,"type","button"),y(w,"class",b=""+((e[0]===lt.move?e[2].active:e[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-r-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")),y(s,"class","inline-flex shadow-sm rounded-md opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-opacity duration-100"),y(m,"type","button"),y(m,"class",k=""+((e[1]===_e.drag?e[2].active:e[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-l-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")),y(N,"type","button"),y(N,"class",L=""+((e[1]===_e.measure?e[2].activeOrange:e[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")),y(C,"type","button"),y(C,"class",z=""+((e[1]===_e.manualAdd?e[2].activeGreen:e[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")),y(E,"type","button"),y(E,"class",ie=""+((e[1]===_e.manualRemove?e[2].activeRed:e[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-r-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")),y(p,"class","inline-flex shadow-sm rounded-md opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-opacity duration-100"),y(t,"class","absolute z-10 bottom-2 right-2 flex space-x-2")},m(v,S){Ve(v,t,S),d(t,s),d(s,r),q(o,r,null),d(s,l),d(s,w),q(f,w,null),d(t,h),d(t,p),d(p,m),q(g,m,null),d(p,I),d(p,N),q(j,N,null),d(p,M),d(p,C),q(P,C,null),d(p,D),d(p,E),q(ee,E,null),re=!0,x||(T=[je(r,"click",e[5]),at(ut.call(null,r,{content:"Zoom on scroll"})),je(w,"click",e[6]),at(ut.call(null,w,{content:"Pan on scroll"})),je(m,"click",e[7]),at(ut.call(null,m,{content:"Click and drag to navigate"})),je(N,"click",e[8]),at(ut.call(null,N,{content:"Measure distance on micrograph"})),je(C,"click",e[9]),at(ut.call(null,C,{content:"Click to add manual picks"})),je(E,"click",e[10]),at(ut.call(null,E,{content:"Click to remove manual picks"}))],x=!0)},p(v,[S]){(!re||S&1&&a!==(a=""+((v[0]===lt.zoom?v[2].active:v[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-l-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")))&&y(r,"class",a),(!re||S&1&&b!==(b=""+((v[0]===lt.move?v[2].active:v[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-r-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")))&&y(w,"class",b),(!re||S&2&&k!==(k=""+((v[1]===_e.drag?v[2].active:v[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-l-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")))&&y(m,"class",k),(!re||S&2&&L!==(L=""+((v[1]===_e.measure?v[2].activeOrange:v[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")))&&y(N,"class",L),(!re||S&2&&z!==(z=""+((v[1]===_e.manualAdd?v[2].activeGreen:v[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")))&&y(C,"class",z),(!re||S&2&&ie!==(ie=""+((v[1]===_e.manualRemove?v[2].activeRed:v[2].default)+" -ml-px relative inline-flex items-center px-1.5 py-1 rounded-r-md border text-xs leading-4 font-medium focus:z-10 focus:outline-none transition ease-in-out duration-150")))&&y(E,"class",ie)},i(v){re||(O(o.$$.fragment,v),O(f.$$.fragment,v),O(g.$$.fragment,v),O(j.$$.fragment,v),O(P.$$.fragment,v),O(ee.$$.fragment,v),re=!0)},o(v){H(o.$$.fragment,v),H(f.$$.fragment,v),H(g.$$.fragment,v),H(j.$$.fragment,v),H(P.$$.fragment,v),H(ee.$$.fragment,v),re=!1},d(v){v&&$(t),G(o),G(f),G(g),G(j),G(P),G(ee),x=!1,Ct(T)}}}function Bs(e,t,s){let{exposureWheelMode:r}=t,{exposureClickMode:o}=t;const a={default:"border-gray-300 bg-white text-gray-600 hover:text-gray-500 focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-100 active:text-gray-700",active:"border-blue-400 bg-blue-100 text-blue-600 hover:text-blue-500 focus:border-blue-500 focus:shadow-outline-blue active:bg-blue-100 active:text-blue-700 z-10",activeGreen:"border-green-400 bg-green-100 text-green-600 hover:text-green-500 focus:border-green-500 focus:shadow-outline-green active:bg-green-100 active:text-green-700 z-10",activeRed:"border-red-400 bg-red-100 text-red-600 hover:text-red-500 focus:border-red-500 focus:shadow-outline-red active:bg-red-100 active:text-red-700 z-10",activeOrange:"border-orange-400 bg-orange-100 text-orange-600 hover:text-orange-500 focus:border-orange-500 focus:shadow-outline-orange active:bg-orange-100 active:text-orange-700 z-10"},l=Vt(),w=I=>{l("changewheelmode",{wheelMode:I})},f=I=>{l("changeclickmode",{clickMode:I})};Mt(()=>{f(_e.manualAdd)});const b=()=>w(lt.zoom),h=()=>w(lt.move),p=()=>f(_e.drag),m=()=>f(_e.measure),g=()=>f(_e.manualAdd),k=()=>f(_e.manualRemove);return e.$$set=I=>{"exposureWheelMode"in I&&s(0,r=I.exposureWheelMode),"exposureClickMode"in I&&s(1,o=I.exposureClickMode)},[r,o,a,w,f,b,h,p,m,g,k]}class Vs extends rt{constructor(t){super();nt(this,t,Bs,Ws,ot,{exposureWheelMode:0,exposureClickMode:1})}}function Os(e){let t,s,r;return{c(){t=A("canvas"),this.h()},l(o){t=R(o,"CANVAS",{id:!0,class:!0,style:!0,width:!0,height:!0}),B(t).forEach($),this.h()},h(){var o,a;y(t,"id","exposure-canvas"),y(t,"class","exposure-canvas absolute top-0 left-0 h-full w-full"),Et(t,"opacity",e[18]===!1&&e[19]!==null&&e[15]===!1?"1":"0"),y(t,"width",s=(o=e[17])!=null?o:0),y(t,"height",r=(a=e[16])!=null?a:0)},m(o,a){Ve(o,t,a),e[32](t)},p(o,a){var l,w;a[0]&819200&&Et(t,"opacity",o[18]===!1&&o[19]!==null&&o[15]===!1?"1":"0"),a[0]&131072&&s!==(s=(l=o[17])!=null?l:0)&&y(t,"width",s),a[0]&65536&&r!==(r=(w=o[16])!=null?w:0)&&y(t,"height",r)},i:oe,o:oe,d(o){o&&$(t),e[32](null)}}}function Hs(e,t,s){let r,o,a=oe,l=()=>(a(),a=ue(Q,n=>s(25,o=n)),Q),w,f=oe,b=()=>(f(),f=ue(We,n=>s(26,w=n)),We),h,p=oe,m=()=>(p(),p=ue(pe,n=>s(27,h=n)),pe),g,k=oe,I=()=>(k(),k=ue(se,n=>s(28,g=n)),se),N,j=oe,L=()=>(j(),j=ue($e,n=>s(29,N=n)),$e),M,C=oe,P=()=>(C(),C=ue(ye,n=>s(30,M=n)),ye),z,D=oe,E=()=>(D(),D=ue(Re,n=>s(31,z=n)),Re),ee,ie=oe,re=()=>(ie(),ie=ue(Ce,n=>s(15,ee=n)),Ce),x,T=oe,v=()=>(T(),T=ue(we,n=>s(34,x=n)),we),S,c=oe,W=()=>(c(),c=ue(Be,n=>s(16,S=n)),Be),Z,J=oe,le=()=>(J(),J=ue(Ne,n=>s(17,Z=n)),Ne),ze,be=oe,ke=()=>(be(),be=ue(Pe,n=>s(35,ze=n)),Pe),ne,Le=oe,ce=()=>(Le(),Le=ue(Ue,n=>s(18,ne=n)),Ue),Ee,He=oe,Ie=()=>(He(),He=ue(Ae,n=>s(19,Ee=n)),Ae);e.$$.on_destroy.push(()=>a()),e.$$.on_destroy.push(()=>f()),e.$$.on_destroy.push(()=>p()),e.$$.on_destroy.push(()=>k()),e.$$.on_destroy.push(()=>j()),e.$$.on_destroy.push(()=>C()),e.$$.on_destroy.push(()=>D()),e.$$.on_destroy.push(()=>ie()),e.$$.on_destroy.push(()=>T()),e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>J()),e.$$.on_destroy.push(()=>be()),e.$$.on_destroy.push(()=>Le()),e.$$.on_destroy.push(()=>He());let{loadingDisplay:Ce}=t;re();let{loadingImage:Ue}=t;ce();let{micWidth:we}=t;v();let{currentImageUrl:Ae}=t;Ie();let{showPicks:We}=t;b();let{picksColor:pe}=t;m();let{showBox:Q}=t;l();let{boxColor:se}=t;I();let{pSize:Pe}=t;ke();let{currentPicks:Re}=t;E();let{boxsizeRawPix:$e}=t;L();let{particleDiameter:ye}=t;P();let{addPick:De}=t,{removePick:he}=t,{exposureNode:te}=t,{thumbWidth:Ne}=t;le();let{thumbHeight:Be}=t;W();let{exposureClickMode:ve}=t,{scale:Ge}=t,Fe;const Ye=(n,U,V,ae)=>{if(typeof n=="undefined"||n===null)return;const Me=Z*U,Xe=S*(1-V);n.beginPath(),n.arc(Me,Xe,ae*Z,0,2*Math.PI,!1),n.lineWidth=2,n.strokeStyle=h,n.stroke()},st=n=>{n.globalCompositeOperation="destination-over";const U=Math.round(M/ze)/x/2;z.forEach(V=>{Ye(n,V[0],V[1],U)})},qe=(n,U,V,ae)=>{if(typeof n=="undefined"||n===null)return;const Me=Z*U-ae/2,Xe=S*(1-V)-ae/2,{r:et,g:tt,b:pt}=qt(g);n.lineWidth=2,n.fillStyle=`rgba(${et}, ${tt}, ${pt}, 0.4)`,n.strokeStyle=g,n.strokeRect(Me,Xe,ae,ae),n.fillRect(Me,Xe,ae,ae)},ft=n=>{const U=N/x*Z;z.forEach(V=>{qe(n,V[0],V[1],U)})},Qe=(n=!0,U=!0)=>{const V=Fe.getContext("2d");typeof V=="undefined"||V===null||(V.clearRect(0,0,Z,S),n&&st(V),U&&ft(V))},mt=n=>{const{clientX:U,clientY:V}=n,{left:ae,top:Me}=Fe.getBoundingClientRect(),Xe=U-ae,et=V-Me,tt=Xe/Ge/Z,pt=1-et/Ge/S,Ut=N/x/2;return{xFrac:tt,yFrac:pt,distFrac:Ut}},gt=async n=>{if(r){const{xFrac:U,yFrac:V,distFrac:ae}=mt(n);ve===_e.manualAdd?n.altKey?await he(U,V,ae):await De(U,V):n.altKey?await De(U,V):await he(U,V,ae),Qe(w,o)}},i=async n=>{if(r){n.preventDefault();const{xFrac:U,yFrac:V,distFrac:ae}=mt(n);ve===_e.manualAdd?await he(U,V,ae):await De(U,V),Qe(w,o)}};Ot(()=>{te.removeEventListener("click",gt),te.removeEventListener("contextmenu",i)});function u(n){ct[n?"unshift":"push"](()=>{Fe=n,s(14,Fe)})}return e.$$set=n=>{"loadingDisplay"in n&&re(s(0,Ce=n.loadingDisplay)),"loadingImage"in n&&ce(s(1,Ue=n.loadingImage)),"micWidth"in n&&v(s(2,we=n.micWidth)),"currentImageUrl"in n&&Ie(s(3,Ae=n.currentImageUrl)),"showPicks"in n&&b(s(4,We=n.showPicks)),"picksColor"in n&&m(s(5,pe=n.picksColor)),"showBox"in n&&l(s(6,Q=n.showBox)),"boxColor"in n&&I(s(7,se=n.boxColor)),"pSize"in n&&ke(s(8,Pe=n.pSize)),"currentPicks"in n&&E(s(9,Re=n.currentPicks)),"boxsizeRawPix"in n&&L(s(10,$e=n.boxsizeRawPix)),"particleDiameter"in n&&P(s(11,ye=n.particleDiameter)),"addPick"in n&&s(20,De=n.addPick),"removePick"in n&&s(21,he=n.removePick),"exposureNode"in n&&s(22,te=n.exposureNode),"thumbWidth"in n&&le(s(12,Ne=n.thumbWidth)),"thumbHeight"in n&&W(s(13,Be=n.thumbHeight)),"exposureClickMode"in n&&s(23,ve=n.exposureClickMode),"scale"in n&&s(24,Ge=n.scale)},e.$$.update=()=>{e.$$.dirty[0]&8388608&&(r=ve===_e.manualAdd||ve===_e.manualRemove),e.$$.dirty[0]&4227072&&!ee&&te&&(te.addEventListener("click",gt),te.addEventListener("contextmenu",i)),e.$$.dirty[0]&2113945600|e.$$.dirty[1]&1&&Fe&&Array.isArray(z)&&(M||N||g||h)&&Qe(w,o)},[Ce,Ue,we,Ae,We,pe,Q,se,Pe,Re,$e,ye,Ne,Be,Fe,ee,S,Z,ne,Ee,De,he,te,ve,Ge,o,w,h,g,N,M,z,u]}class Fs extends rt{constructor(t){super();nt(this,t,Hs,Os,ot,{loadingDisplay:0,loadingImage:1,micWidth:2,currentImageUrl:3,showPicks:4,picksColor:5,showBox:6,boxColor:7,pSize:8,currentPicks:9,boxsizeRawPix:10,particleDiameter:11,addPick:20,removePick:21,exposureNode:22,thumbWidth:12,thumbHeight:13,exposureClickMode:23,scale:24},null,[-1,-1])}}function Ys(e){let t,s,r,o,a,l,w,f,b=Je(e[1])+"",h,p,m,g,k,I,N,j,L,M=Je(e[2])+"",C,P,z,D,E,ee,ie,re,x,T=Je(e[3])+"",v,S,c,W,Z,J,le,ze,be,ke=Je(e[4])+"",ne,Le,ce,Ee,He,Ie,Ce,Ue,we,Ae,We,pe;return r=new Oe({props:{src:Ds,size:4,modifier:"mr-1.5 text-green-700"}}),g=new Oe({props:{src:Ts,size:4,modifier:"mr-1.5 text-teal-700"}}),D=new Oe({props:{src:Es,size:4,modifier:"mr-1.5 text-orange-700"}}),W=new Oe({props:{src:Ms,size:4,modifier:"mr-1.5 text-teal-700"}}),Ee=new Oe({props:{src:$s,type:"outline",size:4,modifier:"stroke-2 mr-1.5 text-blue-700"}}),{c(){t=A("div"),s=A("div"),X(r.$$.fragment),o=F(),a=A("p"),l=Te("Total Micrographs:"),w=F(),f=A("p"),h=Te(b),p=F(),m=A("div"),X(g.$$.fragment),k=F(),I=A("p"),N=Te("Total with Picks:"),j=F(),L=A("p"),C=Te(M),P=F(),z=A("div"),X(D.$$.fragment),E=F(),ee=A("p"),ie=Te("Total without Picks:"),re=F(),x=A("p"),v=Te(T),S=F(),c=A("div"),X(W.$$.fragment),Z=F(),J=A("p"),le=Te("Total Picks:"),ze=F(),be=A("p"),ne=Te(ke),Le=F(),ce=A("div"),X(Ee.$$.fragment),He=F(),Ie=A("p"),Ce=Te("Box Size Ratio:"),Ue=F(),we=A("p"),Ae=Te(e[0]),We=Te("x"),this.h()},l(Q){t=R(Q,"DIV",{class:!0});var se=B(t);s=R(se,"DIV",{class:!0});var Pe=B(s);K(r.$$.fragment,Pe),o=Y(Pe),a=R(Pe,"P",{class:!0});var Re=B(a);l=Se(Re,"Total Micrographs:"),Re.forEach($),w=Y(Pe),f=R(Pe,"P",{class:!0});var $e=B(f);h=Se($e,b),$e.forEach($),Pe.forEach($),p=Y(se),m=R(se,"DIV",{class:!0});var ye=B(m);K(g.$$.fragment,ye),k=Y(ye),I=R(ye,"P",{class:!0});var De=B(I);N=Se(De,"Total with Picks:"),De.forEach($),j=Y(ye),L=R(ye,"P",{class:!0});var he=B(L);C=Se(he,M),he.forEach($),ye.forEach($),P=Y(se),z=R(se,"DIV",{class:!0});var te=B(z);K(D.$$.fragment,te),E=Y(te),ee=R(te,"P",{class:!0});var Ne=B(ee);ie=Se(Ne,"Total without Picks:"),Ne.forEach($),re=Y(te),x=R(te,"P",{class:!0});var Be=B(x);v=Se(Be,T),Be.forEach($),te.forEach($),S=Y(se),c=R(se,"DIV",{class:!0});var ve=B(c);K(W.$$.fragment,ve),Z=Y(ve),J=R(ve,"P",{class:!0});var Ge=B(J);le=Se(Ge,"Total Picks:"),Ge.forEach($),ze=Y(ve),be=R(ve,"P",{class:!0});var Fe=B(be);ne=Se(Fe,ke),Fe.forEach($),ve.forEach($),Le=Y(se),ce=R(se,"DIV",{class:!0});var Ye=B(ce);K(Ee.$$.fragment,Ye),He=Y(Ye),Ie=R(Ye,"P",{class:!0});var st=B(Ie);Ce=Se(st,"Box Size Ratio:"),st.forEach($),Ue=Y(Ye),we=R(Ye,"P",{class:!0});var qe=B(we);Ae=Se(qe,e[0]),We=Se(qe,"x"),qe.forEach($),Ye.forEach($),se.forEach($),this.h()},h(){y(a,"class","text-green-700 font-medium"),y(f,"class","ml-1 font-semibold text-green-700"),y(s,"class","relative inline-flex items-center py-1 px-2 rounded-full leading-4 bg-green-100"),y(I,"class","text-teal-700 font-medium"),y(L,"class","ml-1 font-semibold text-teal-700"),y(m,"class","relative inline-flex items-center py-1 px-2 rounded-full leading-4 bg-teal-100"),y(ee,"class","text-orange-700 font-medium"),y(x,"class","ml-1 font-semibold text-orange-700"),y(z,"class","relative inline-flex items-center py-1 px-2 rounded-full leading-4 bg-orange-100"),y(J,"class","text-teal-700 font-medium"),y(be,"class","ml-1 font-semibold text-teal-700"),y(c,"class","relative inline-flex items-center py-1 px-2.5 rounded-full leading-4 bg-teal-100"),y(Ie,"class","text-blue-700 font-medium"),y(we,"class","ml-1 font-semibold text-blue-700"),y(ce,"class","relative inline-flex items-center py-1 px-2 rounded-full leading-4 bg-blue-100"),y(t,"class","flex flex-wrap items-center gap-x-2 gap-y-1 h-full text-xs")},m(Q,se){Ve(Q,t,se),d(t,s),q(r,s,null),d(s,o),d(s,a),d(a,l),d(s,w),d(s,f),d(f,h),d(t,p),d(t,m),q(g,m,null),d(m,k),d(m,I),d(I,N),d(m,j),d(m,L),d(L,C),d(t,P),d(t,z),q(D,z,null),d(z,E),d(z,ee),d(ee,ie),d(z,re),d(z,x),d(x,v),d(t,S),d(t,c),q(W,c,null),d(c,Z),d(c,J),d(J,le),d(c,ze),d(c,be),d(be,ne),d(t,Le),d(t,ce),q(Ee,ce,null),d(ce,He),d(ce,Ie),d(Ie,Ce),d(ce,Ue),d(ce,we),d(we,Ae),d(we,We),pe=!0},p(Q,[se]){(!pe||se&2)&&b!==(b=Je(Q[1])+"")&&it(h,b),(!pe||se&4)&&M!==(M=Je(Q[2])+"")&&it(C,M),(!pe||se&8)&&T!==(T=Je(Q[3])+"")&&it(v,T),(!pe||se&16)&&ke!==(ke=Je(Q[4])+"")&&it(ne,ke),(!pe||se&1)&&it(Ae,Q[0])},i(Q){pe||(O(r.$$.fragment,Q),O(g.$$.fragment,Q),O(D.$$.fragment,Q),O(W.$$.fragment,Q),O(Ee.$$.fragment,Q),pe=!0)},o(Q){H(r.$$.fragment,Q),H(g.$$.fragment,Q),H(D.$$.fragment,Q),H(W.$$.fragment,Q),H(Ee.$$.fragment,Q),pe=!1},d(Q){Q&&$(t),G(r),G(g),G(D),G(W),G(Ee)}}}function Xs(e,t,s){let r,o,a,l,w,f,b,h;const{numMicsTotal:p,boxsizeRawPix:m,particleDiameter:g,pSize:k,totalWithPicks:I,totalWithoutPicks:N,allPicksCount:j}=yt("manualPickerData");return Ke(e,p,L=>s(1,w=L)),Ke(e,m,L=>s(14,l=L)),Ke(e,g,L=>s(13,a=L)),Ke(e,k,L=>s(12,o=L)),Ke(e,I,L=>s(2,f=L)),Ke(e,N,L=>s(3,b=L)),Ke(e,j,L=>s(4,h=L)),e.$$.update=()=>{e.$$.dirty&28672&&s(0,r=(l/(a/o)).toFixed(2))},[r,w,f,b,h,p,m,g,k,I,N,j,o,a,l]}class Ks extends rt{constructor(t){super();nt(this,t,Xs,Ys,ot,{})}}function qs(e){let t,s,r,o;return r=new os({}),{c(){t=A("div"),s=A("span"),X(r.$$.fragment),this.h()},l(a){t=R(a,"DIV",{class:!0});var l=B(t);s=R(l,"SPAN",{class:!0});var w=B(s);K(r.$$.fragment,w),w.forEach($),l.forEach($),this.h()},h(){y(s,"class","absolute-center"),y(t,"class","absolute top-0 left-0 h-full w-full bg-white")},m(a,l){Ve(a,t,l),d(t,s),q(r,s,null),o=!0},p:oe,i(a){o||(O(r.$$.fragment,a),o=!0)},o(a){H(r.$$.fragment,a),o=!1},d(a){a&&$(t),G(r)}}}function Gs(e){let t,s,r,o,a,l,w=(e[2]?"Output Locations":"Extract Particles")+"",f,b,h,p,m,g,k,I,N,j,L,M,C,P,z,D,E,ee,ie,re;return s=new Ks({}),g=new is({props:{heading:"Exposure Plot",$$slots:{default:[Zs]},$$scope:{ctx:e}}}),I=new ss({props:{tableFilter:e[37],tabulatorTable:e[40],selectedMic:e[35]}}),j=new rs({props:{micrographsList:e[8],fields:e[9],selectedMic:e[35],setMicrograph:e[36],tableFilter:e[37],tabulatorTable:e[40],overviewHoverUid:e[15],hasThumbnails:e[13],hoverAnchorNode:e[1]}}),M=new ls({props:{hoverAnchorNode:e[3],overviewHoverUid:e[16],hasThumbnails:e[4],overviewHoverData:e[17],hoverAttributes:e[18],getThumbnailUrl:e[42]}}),z=new Ls({}),E=new hs({props:{loadingDisplay:e[6],loadingImage:e[7],currentImageUrl:e[11],selectedMicUid:e[12],thumbWidth:e[21],thumbHeight:e[22],micWidth:e[19],pSize:e[20],showScale:e[25],$$slots:{canvas:[tr,({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>({55:x,56:T,57:v,58:S,59:c,60:W}),({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>[0,(x?16777216:0)|(T?33554432:0)|(v?67108864:0)|(S?134217728:0)|(c?268435456:0)|(W?536870912:0)]],"interact-controls":[er,({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>({55:x,56:T,57:v,58:S,59:c,60:W}),({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>[0,(x?16777216:0)|(T?33554432:0)|(v?67108864:0)|(S?134217728:0)|(c?268435456:0)|(W?536870912:0)]],"lowpass-filter":[Qs,({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>({55:x,56:T,57:v,58:S,59:c,60:W}),({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>[0,(x?16777216:0)|(T?33554432:0)|(v?67108864:0)|(S?134217728:0)|(c?268435456:0)|(W?536870912:0)]],"download-image":[Js,({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>({55:x,56:T,57:v,58:S,59:c,60:W}),({exposureNode:x,exposureClickMode:T,exposureWheelMode:v,scale:S,handleChangeClickMode:c,handleChangeWheelMode:W})=>[0,(x?16777216:0)|(T?33554432:0)|(v?67108864:0)|(S?134217728:0)|(c?268435456:0)|(W?536870912:0)]]},$$scope:{ctx:e}}}),{c(){t=A("div"),X(s.$$.fragment),r=F(),o=A("span"),a=A("button"),l=Te("Done Picking | "),f=Te(w),b=F(),h=A("div"),p=A("div"),m=A("div"),X(g.$$.fragment),k=F(),X(I.$$.fragment),N=F(),X(j.$$.fragment),L=F(),X(M.$$.fragment),C=F(),P=A("div"),X(z.$$.fragment),D=F(),X(E.$$.fragment),this.h()},l(x){t=R(x,"DIV",{class:!0});var T=B(t);K(s.$$.fragment,T),r=Y(T),o=R(T,"SPAN",{class:!0});var v=B(o);a=R(v,"BUTTON",{type:!0,class:!0});var S=B(a);l=Se(S,"Done Picking | "),f=Se(S,w),S.forEach($),v.forEach($),T.forEach($),b=Y(x),h=R(x,"DIV",{class:!0});var c=B(h);p=R(c,"DIV",{class:!0});var W=B(p);m=R(W,"DIV",{class:!0});var Z=B(m);K(g.$$.fragment,Z),k=Y(Z),K(I.$$.fragment,Z),N=Y(Z),K(j.$$.fragment,Z),Z.forEach($),L=Y(W),K(M.$$.fragment,W),W.forEach($),C=Y(c),P=R(c,"DIV",{class:!0});var J=B(P);K(z.$$.fragment,J),D=Y(J),K(E.$$.fragment,J),J.forEach($),c.forEach($),this.h()},h(){y(a,"type","button"),y(a,"class","inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs leading-4 font-medium rounded whitespace-nowrap text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:border-green-700 focus:shadow-outline-green active:bg-green-700 transition ease-in-out duration-150"),y(o,"class","inline-flex items-start h-full ml-auto rounded shadow-sm"),y(t,"class","w-full flex justify-between px-2 py-1.5 whitespace-nowrap border-b border-gray-200 bg-white"),y(m,"class","flex flex-col h-full"),y(p,"class","table-col interactive-panel flex-1 flex flex-col max-h-full bg-white border-r border-gray-300 overflow-y-auto svelte-1ahy4by"),y(P,"class","flex-1 flex flex-col overflow-y-hidden"),y(h,"class","flex h-full overflow-y-hidden")},m(x,T){Ve(x,t,T),q(s,t,null),d(t,r),d(t,o),d(o,a),d(a,l),d(a,f),Ve(x,b,T),Ve(x,h,T),d(h,p),d(p,m),q(g,m,null),d(m,k),q(I,m,null),d(m,N),q(j,m,null),d(p,L),q(M,p,null),d(h,C),d(h,P),q(z,P,null),d(P,D),q(E,P,null),ee=!0,ie||(re=je(a,"click",e[44]),ie=!0)},p(x,T){(!ee||T[0]&4)&&w!==(w=(x[2]?"Output Locations":"Extract Particles")+"")&&it(f,w);const v={};T[0]&2|T[1]&1073741824&&(v.$$scope={dirty:T,ctx:x}),g.$set(v);const S={};T[0]&2&&(S.hoverAnchorNode=x[1]),j.$set(S);const c={};T[0]&8&&(c.hoverAnchorNode=x[3]),T[0]&16&&(c.hasThumbnails=x[4]),M.$set(c);const W={};T[1]&2130706432&&(W.$$scope={dirty:T,ctx:x}),E.$set(W)},i(x){ee||(O(s.$$.fragment,x),O(g.$$.fragment,x),O(I.$$.fragment,x),O(j.$$.fragment,x),O(M.$$.fragment,x),O(z.$$.fragment,x),O(E.$$.fragment,x),ee=!0)},o(x){H(s.$$.fragment,x),H(g.$$.fragment,x),H(I.$$.fragment,x),H(j.$$.fragment,x),H(M.$$.fragment,x),H(z.$$.fragment,x),H(E.$$.fragment,x),ee=!1},d(x){x&&$(t),G(s),x&&$(b),x&&$(h),G(g),G(I),G(j),G(M),G(z),G(E),ie=!1,re()}}}function Zs(e){let t,s,r;function o(l){e[45](l)}let a={exposures:e[8],fields:e[9],setMicrograph:e[43],overviewHoverUid:e[15],plotAxisX:e[28],plotAxisY:e[29],chartType:e[30],nbinsx:e[31]};return e[1]!==void 0&&(a.hoverAnchorNode=e[1]),t=new us({props:a}),ct.push(()=>vt(t,"hoverAnchorNode",o)),{c(){X(t.$$.fragment)},l(l){K(t.$$.fragment,l)},m(l,w){q(t,l,w),r=!0},p(l,w){const f={};!s&&w[0]&2&&(s=!0,f.hoverAnchorNode=l[1],_t(()=>s=!1)),t.$set(f)},i(l){r||(O(t.$$.fragment,l),r=!0)},o(l){H(t.$$.fragment,l),r=!1},d(l){G(t,l)}}}function Js(e){let t,s;return t=new ns({props:{slot:"download-image",currentImageUrl:e[11],selectedMicUid:e[12]}}),{c(){X(t.$$.fragment)},l(r){K(t.$$.fragment,r)},m(r,o){q(t,r,o),s=!0},p:oe,i(r){s||(O(t.$$.fragment,r),s=!0)},o(r){H(t.$$.fragment,r),s=!1},d(r){G(t,r)}}}function Qs(e){let t,s;return t=new bs({props:{slot:"lowpass-filter",lowPassFilter:e[27],getImage:e[41]}}),{c(){X(t.$$.fragment)},l(r){K(t.$$.fragment,r)},m(r,o){q(t,r,o),s=!0},p:oe,i(r){s||(O(t.$$.fragment,r),s=!0)},o(r){H(t.$$.fragment,r),s=!1},d(r){G(t,r)}}}function er(e){let t,s;return t=new Vs({props:{slot:"interact-controls",exposureClickMode:e[56],exposureWheelMode:e[57]}}),t.$on("changeclickmode",function(){wt(e[59])&&e[59].apply(this,arguments)}),t.$on("changewheelmode",function(){wt(e[60])&&e[60].apply(this,arguments)}),{c(){X(t.$$.fragment)},l(r){K(t.$$.fragment,r)},m(r,o){q(t,r,o),s=!0},p(r,o){e=r;const a={};o[1]&33554432&&(a.exposureClickMode=e[56]),o[1]&67108864&&(a.exposureWheelMode=e[57]),t.$set(a)},i(r){s||(O(t.$$.fragment,r),s=!0)},o(r){H(t.$$.fragment,r),s=!1},d(r){G(t,r)}}}function tr(e){let t,s,r;return s=new Fs({props:{loadingDisplay:e[6],loadingImage:e[7],micWidth:e[19],currentImageUrl:e[11],showPicks:e[32],picksColor:e[23],showBox:e[33],boxColor:e[24],currentPicks:e[10],boxsizeRawPix:e[26],particleDiameter:e[34],pSize:e[20],addPick:e[38],removePick:e[39],thumbWidth:e[21],thumbHeight:e[22],scale:e[58],exposureNode:e[55],exposureClickMode:e[56]}}),{c(){t=A("div"),X(s.$$.fragment),this.h()},l(o){t=R(o,"DIV",{slot:!0,class:!0});var a=B(t);K(s.$$.fragment,a),a.forEach($),this.h()},h(){y(t,"slot","canvas"),y(t,"class","h-full w-full")},m(o,a){Ve(o,t,a),q(s,t,null),r=!0},p(o,a){const l={};a[1]&134217728&&(l.scale=o[58]),a[1]&16777216&&(l.exposureNode=o[55]),a[1]&33554432&&(l.exposureClickMode=o[56]),s.$set(l)},i(o){r||(O(s.$$.fragment,o),r=!0)},o(o){H(s.$$.fragment,o),r=!1},d(o){o&&$(t),G(s)}}}function sr(e){let t,s,r,o,a,l;s=new as({props:{errors:e[5]}});const w=[Gs,qs],f=[];function b(h,p){return h[0]?1:0}return o=b(e),a=f[o]=w[o](e),{c(){t=A("div"),X(s.$$.fragment),r=F(),a.c(),this.h()},l(h){t=R(h,"DIV",{class:!0});var p=B(t);K(s.$$.fragment,p),r=Y(p),a.l(p),p.forEach($),this.h()},h(){y(t,"class","relative w-full h-full flex flex-col bg-white")},m(h,p){Ve(h,t,p),q(s,t,null),d(t,r),f[o].m(t,null),l=!0},p(h,p){let m=o;o=b(h),o===m?f[o].p(h,p):(Pt(),H(f[m],1,1,()=>{f[m]=null}),$t(),a=f[o],a?a.p(h,p):(a=f[o]=w[o](h),a.c()),O(a,1),a.m(t,null))},i(h){l||(O(s.$$.fragment,h),O(a),l=!0)},o(h){H(s.$$.fragment,h),H(a),l=!1},d(h){h&&$(t),G(s),f[o].d()}}}function rr(e,t,s){let r,o,a,l=oe,w=()=>(l(),l=ue($e,te=>s(3,a=te)),$e),f;e.$$.on_destroy.push(()=>l());const{host:b,port:h,projectUid:p,jobUid:m}=yt("jobData"),g=Ss(b,h,p,m);Ht("manualPickerData",g);const{interactiveError:k,loadingDisplay:I,loadingImage:N,micrographsList:j,fields:L,currentPicks:M,currentImageUrl:C,selectedMicUid:P,hasThumbnails:z,outputLocationsOnly:D,overviewHoverUid:E,overviewHoverUidFromIdx:ee,overviewHoverData:ie,hoverAttributes:re,micWidth:x,pSize:T,thumbWidth:v,thumbHeight:S,picksColor:c,boxColor:W,showScale:Z,boxsizeRawPix:J,lowPassFilter:le,plotAxisX:ze,plotAxisY:be,chartType:ke,nbinsx:ne,showPicks:Le,showBox:ce,particleDiameter:Ee,selectedMic:He,setMicrograph:Ie,tableFilter:Ce,addPick:Ue,removePick:we,tabulatorTable:Ae,getImage:We,getInteractiveInfo:pe,getList:Q,getThumbnailUrl:se,startExtraction:Pe}=g;Ke(e,j,te=>s(46,r=te)),Ke(e,z,te=>s(4,f=te)),Ke(e,D,te=>s(2,o=te));let Re=!0,$e;const ye=te=>{var Be;const Ne=r.find(ve=>ve.idx===te);Ie((Be=Ne==null?void 0:Ne.uid)!=null?Be:"")},De=()=>{Pe(),Zt.set(Gt.log),Jt.set(!0)};Mt(async()=>{s(0,Re=!0),await pe(),await Q(),s(0,Re=!1)});function he(te){$e=te,w(s(1,$e))}return[Re,$e,o,a,f,k,I,N,j,L,M,C,P,z,D,E,ee,ie,re,x,T,v,S,c,W,Z,J,le,ze,be,ke,ne,Le,ce,Ee,He,Ie,Ce,Ue,we,Ae,We,se,ye,De,he]}class on extends rt{constructor(t){super();nt(this,t,rr,sr,ot,{},null,[-1,-1])}}export{on as default};
