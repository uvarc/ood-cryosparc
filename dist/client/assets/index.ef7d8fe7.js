var F=Object.defineProperty,z=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var U=(t,s,e)=>s in t?F(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,w=(t,s)=>{for(var e in s||(s={}))Z.call(s,e)&&U(t,e,s[e]);if(x)for(var e of x(s))G.call(s,e)&&U(t,e,s[e]);return t},k=(t,s)=>z(t,K(s));import{g as y}from"./vendor.3ae73048.js";import{u as v,e as m,aq as V,ar as H,p as B,n as Q}from"./index.146c2037.js";import{M as X,R as ee,N as te,V as se,O as l}from"./index.11580965.js";import{u as E,h as C,f as O,g as D}from"./helpers.7177ca38.js";import{K as _}from"./router.1b465492.js";function Y(t){const s=y(_),{workflowVersion:e,csVersion:o,createdAt:r,createdBy:c,jobs:a,parents:i}=t,n={workflowVersion:e,csVersion:o,createdAt:r,createdBy:c,parents:i,jobs:{}},d={},p=Object.entries(a);for(let u=0;u<p.length;u++){const[f,j]=p[u],{jobType:b,groups:T,individualResults:N,parameters:W}=j,{baseParams:q={}}=s[b],g=Object.entries(W),S={jobType:b,groups:T,individualResults:N,parameters:{}};for(let h=0;h<g.length;h++){const[J,P]=g[h],{value:I,locked:R,visible:L,flagged:A}=P,M=q[J];let $={locked:R,visible:L,flagged:A};M.type!=="path"?$.value=I:$.value="",S.parameters[J]=$}d[f]=S}return n.jobs=d,n}function oe(t,s,e={}){try{if(!t)throw new Error("No user id present for created workflow");const{createdBy:o}=s,r=Y(s);v.core.createWorkflow(t,o,JSON.stringify(r),e.forked,e.imported,e.rebuilt)}catch(o){m("Could not relay workspace creation data: ",o.message)}}function re(t,s){var e;try{if(!t)throw new Error("No user id present for updated workflow");const o=Y(s);v.core.editWorkflow(t,(e=y(E))!=null?e:"",JSON.stringify(o))}catch(o){m("Could not relay workspace edit data: ",o.message)}}function fe(t,s,e,o){var r,c;try{const a=y(_),{_id:i,jobs:n={}}=t,d=Object.entries(s),p={};for(let f=0;f<d.length;f++){const[j,b]=d[f],T=n[j];if(!T)continue;const{baseParams:N={}}=a[T.jobType],W=Object.entries((r=b.parameters)!=null?r:{}),q={parameters:{}};for(let g=0;g<W.length;g++){const[S,h]=W[g],{value:J,locked:P,visible:I,flagged:R}=h,L=N[S];let A={locked:P,visible:I,flagged:R};L.type!=="path"?A.value=J:A.value="",q.parameters[S]=A}p[j]=q}const u={queued:e,tagged:o,updates:p};v.core.applyWorkflow(i,(c=y(E))!=null?c:"",JSON.stringify(u))}catch(a){m("Could not relay workspace application data: ",a)}}function ae(t){try{const s=y(E);if(!s)throw new Error("No user id present for current session");v.core.deleteWorkflow(t,s)}catch(s){m("Could not relay workflow deletion data: ",s)}}const ce=async(t,s={})=>{const e=C("Creating workflow");try{const o=k(w({},t),{createdAt:new Date,createdBy:y(E)}),r=await B("/api/actions/workflows/",{workflow:o});O("Workflow created successfully",e),oe(r,o,s)}catch(o){m("Could not create workflow: ",o.message),D("Workflow could not be created",o.message,e)}},be=async t=>{const s=C("Updating workflow");try{const e=k(w({},t),{updatedAt:new Date,updatedBy:y(E)}),o=await B("/api/actions/workflows/",{workflow:e});O("Workflow updated successfully",s),re(o,e)}catch(e){m("Could not update workflow: ",e.message),D("Workflow could not be updated",e.message,s)}},we=async t=>{const s=C("Deleting workflow");try{if(!t)throw new Error("No ID supplied");await B("/api/actions/workflows/delete",{_id:t}),O("Workflow deleted successfully",s),ae(t)}catch(e){m("Could not delete workflow: ",e.message),D("Workflow could not be deleted",e.message,s)}},ye=t=>{const s=C("Exporting workflow");try{const e=t.title.toLowerCase().trim().replace(/[^a-zA-Z0-9_-]/g,"_");t.workflowVersion||(t.workflowVersion=se);const o=JSON.stringify(t),r=new Blob([o],{type:"application/json"}),c=URL.createObjectURL(r),a=document.createElement("a");a.href=c,a.download=e,a.click(),O("Workflow exported successfully",s)}catch(e){D("Workflow could not be exported",e.message,s)}},me=()=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.addEventListener("change",s=>{var r;const e=(r=s.target.files)==null?void 0:r[0],o=new FileReader;o.onload=c=>{var a,i;try{const n=(i=(a=c.target.result)==null?void 0:a.toString())!=null?i:"{}",d=JSON.parse(n);if(!d.workflowVersion)throw new Error("File is not a valid CryoSPARC Workflow.");d.imported=!0,ce(d,{imported:!0})}catch(n){Q.add({title:`Workflow could not be imported: ${n.message}`,type:"danger",style:"minimal"}),m(`Workflow could not be imported: ${n.message}`)}},o.readAsText(e)}),t.click()},je=t=>/^(P[0-9]+)$/i.exec(t)!==null,ge=t=>Object.keys(t).reduce((s,e)=>k(w({},s),{[e]:k(w({},t[e]),{parameters:{}})}),{}),ke=(t,s)=>{var r,c;const e=V(t),o=Object.entries(s);for(let a=0;a<o.length;a++){const[i,n]=o[a],d=t.jobs[i];e.jobs[i]=k(w({},d),{title:(r=n.title)!=null?r:d.title,description:(c=n.description)!=null?c:d.description,parameters:w(w({},d.parameters),n.parameters)})}return e},Se=t=>{var r;const s=y(_),e={};for(const c of Object.values(t))if(!e[c.jobType]){const a=s[c.jobType];e[c.jobType]=V(a)}const o={};for(const[c,a]of Object.entries(e)){const i=a;for(const n of H)((r=i==null?void 0:i.baseParams)==null?void 0:r[n])&&(i.baseParams[n].hidden=!1);o[c]=i}return o},he=t=>{var e,o,r;const s=[];for(const c in t){const a=t[c],i=a.jobType,n=a.jobType;if(ee.includes(i)&&s.push(`${c}-${i}`),te.includes(n))for(const d in t){const{groups:p=[]}=t[d];for(let u=0;u<p.length;u++){const[f]=(r=(o=(e=p==null?void 0:p[u])==null?void 0:e[0])==null?void 0:o.split("."))!=null?r:[];f===c&&s.push(`${c}-${n}`)}}}return s},Ae=t=>{const s=[];for(const e in t){const r=t[e].jobType;X.includes(r)&&s.push(`${e}-${r}`)}return s},Ee=(t,s)=>{var r,c,a,i,n,d,p,u,f,j;const e=t==null?void 0:t.querySelector(`#${s}-node:not(.disabled)`),o=t==null?void 0:t.querySelector(".selected:not(.disabled)");if(e!==o&&(e&&(e.classList.add("selected"),(r=e.querySelector(".job-card"))==null||r.setAttribute("class",l.card.selected),(c=e.querySelector(".job-title"))==null||c.setAttribute("class",l.title.selected),(a=e.querySelector(".job-id-wrapper"))==null||a.setAttribute("class",l.idWrapper.selected),(i=e.querySelector(".job-id"))==null||i.setAttribute("class",l.id.selected),(n=e.querySelector(".job-flag"))==null||n.setAttribute("class",l.flag.selected)),o)){const b=o.classList.contains("updated");o.classList.remove("selected"),(d=o.querySelector(".job-card"))==null||d.setAttribute("class",b?l.card.updated:l.card.base),(p=o.querySelector(".job-title"))==null||p.setAttribute("class",b?l.title.updated:l.title.base),(u=o.querySelector(".job-id-wrapper"))==null||u.setAttribute("class",b?l.idWrapper.updated:l.idWrapper.base),(f=o.querySelector(".job-id"))==null||f.setAttribute("class",b?l.id.updated:l.id.base),(j=o.querySelector(".job-flag"))==null||j.setAttribute("class",b?l.flag.updated:l.flag.base)}},Te=(t,s)=>{var o,r,c,a,i;const e=t==null?void 0:t.querySelector(`#${s}-node:not(.disabled)`);e&&!e.classList.contains("updated")&&(e.classList.add("updated"),e.classList.contains("selected")||((o=e.querySelector(".job-card"))==null||o.setAttribute("class",l.card.updated),(r=e.querySelector(".job-title"))==null||r.setAttribute("class",l.title.updated),(c=e.querySelector(".job-id-wrapper"))==null||c.setAttribute("class",l.idWrapper.updated),(a=e.querySelector(".job-id"))==null||a.setAttribute("class",l.id.updated),(i=e.querySelector(".job-flag"))==null||i.setAttribute("class",l.flag.updated)))},We=(t,s)=>{var o,r,c,a,i;const e=t==null?void 0:t.querySelector(`#${s}-node:not(.disabled)`);if(e==null?void 0:e.classList.contains("updated")){const n=e.classList.contains("selected");e.classList.remove("updated"),(o=e.querySelector(".job-card"))==null||o.setAttribute("class",n?l.card.selected:l.card.base),(r=e.querySelector(".job-title"))==null||r.setAttribute("class",n?l.title.selected:l.title.base),(c=e.querySelector(".job-id-wrapper"))==null||c.setAttribute("class",n?l.idWrapper.selected:l.idWrapper.base),(a=e.querySelector(".job-id"))==null||a.setAttribute("class",n?l.id.selected:l.id.base),(i=e.querySelector(".job-flag"))==null||i.setAttribute("class",n?l.flag.selected:l.flag.base)}};export{Se as a,Te as b,We as c,ce as d,ge as e,Ae as f,ke as g,he as h,je as i,we as j,ye as k,me as l,fe as r,Ee as s,be as u};
